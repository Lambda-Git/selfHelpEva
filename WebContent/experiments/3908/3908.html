<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.0 Transitional//EN'>
<html>

<head>
    <title>算术计算（练习，幼儿与小学生）</title>
    <meta http-equiv='content-type' content='text/html;charset=utf-8'/>
    <link href='../../OPES2/js/jplayer/skin/blue.monday/css/jplayer.blue.monday.min.css' rel='stylesheet'type='text/css'/>
    <link rel='stylesheet' href='../../OPES2/css/jquery-ui-1.10.4.custom/jquery-ui-1.10.4.custom.min.css'/>
    <link href="../../../css/mui.min.css" rel="stylesheet"/>
</head>

<body>
</body>
<script type='text/javascript' src="../../../js/mui.min.js"></script>
<script type='text/javascript' src='../../OPES2/js/jquery/jquery-1.8.0.min.js'></script>
<script type='text/javascript' src='../../OPES2/js/jqueryui/jquery-ui-1.10.4.custom.min.js'></script>
<script type='text/javascript' src='../../OPES2/js/mousetrap/mousetrap-1.4.6.min.js'></script>
<script type='text/javascript' src='../../OPES2/js/json2/json2.js'></script>
<script type='text/javascript' src='../../OPES2/js/jplayer/jplayer/jquery.jplayer.min.js'></script>
<script type='text/javascript' src='../../js/Statistics/Statistics.js'></script>
<script type='text/javascript' src='../../OPES2/js/soundRecordSwitch/swfobject.js'></script>
<script type='text/javascript' src='../../OPES2/js/fileSaverJS/Blob.js'></script>
<script type='text/javascript' src='../../OPES2/js/fileSaverJS/FileSaver.js'></script>


<script type='text/javascript'>
    /***********************************[constant.js]***********************************/
    var WAIT_FOREVER_TIME = 999999999;

    //ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED will be used as default. User no need to add next button if use this.
    var ROW_ALIVE_TYPE_MUST_WAIT_FOR_ALIVE_TIME_REACHED = 'ROW_ALIVE_TYPE_MUST_WAIT_FOR_ALIVE_TIME_REACHED';//必须等到用户指定的aliveTime才转到下一个row
    var ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED = 'ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED';//响应和aliveTime 哪个先到先走原则，如果必须要等待用户响应，则可以设置aliveTime为999999999

    //column中的刺激的类型
    var STIMULATE_TYPE_NULL = 'STIMULATE_TYPE_NULL';
    var STIMULATE_TYPE_PLAINTEXT = 'STIMULATE_TYPE_PLAINTEXT';
    var STIMULATE_TYPE_BINDANDACCEPTSINGLEKEY = 'STIMULATE_TYPE_BINDANDACCEPTSINGLEKEY';
    var STIMULATE_TYPE_SOUND_SWITCH = 'STIMULATE_TYPE_SOUND_SWITCH';
    var STIMULATE_TYPE_TURNON_SOUND_SWITCH = 'STIMULATE_TYPE_TURNON_SOUND_SWITCH';
    var STIMULATE_TYPE_TURNOFF_SOUND_SWITCH = 'STIMULATE_TYPE_TURNOFF_SOUND_SWITCH';
    var STIMULATE_TYPE_INPUT = 'STIMULATE_TYPE_INPUT';
    var STIMULATE_TYPE_TEXTAREA = 'STIMULATE_TYPE_TEXTAREA';
    var STIMULATE_TYPE_BUTTON = 'STIMULATE_TYPE_BUTTON';
    var STIMULATE_TYPE_RADIOBUTTON = 'STIMULATE_TYPE_RADIOBUTTON';
    var STIMULATE_TYPE_CHECKBOX = 'STIMULATE_TYPE_CHECKBOX';
    var STIMULATE_TYPE_RICHTEXT = 'STIMULATE_TYPE_RICHTEXT';
    var STIMULATE_TYPE_IMAGE = 'STIMULATE_TYPE_IMAGE';
    var STIMULATE_TYPE_SOUND = 'STIMULATE_TYPE_SOUND';
    var STIMULATE_TYPE_FLASH = 'STIMULATE_TYPE_FLASH';
    var STIMULATE_TYPE_VIDEO = 'STIMULATE_TYPE_VIDEO';
    var STIMULATE_TYPE_PRE_CUSTOM_CODE = 'STIMULATE_TYPE_PRE_CUSTOM_CODE';
    var STIMULATE_TYPE_POST_CUSTOM_CODE = 'STIMULATE_TYPE_POST_CUSTOM_CODE';
    var STIMULATE_TYPE_MOUSE_TYPE = 'STIMULATE_TYPE_MOUSE_TYPE';
    var STIMULATE_TYPE_DATE = 'STIMULATE_TYPE_DATE';

    //row的responseType
    var RESPONSE_TYPE_SINGLEKEY = 'RESPONSE_TYPE_SINGLEKEY';
    var RESPONSE_TYPE_MULTIPLEKEY = 'RESPONSE_TYPE_MULTIPLEKEY';
    var RESPONSE_TYPE_SINGLEMOUSECLICK = 'RESPONSE_TYPE_SINGLEMOUSECLICK';
    var RESPONSE_TYPE_MULTIPLCLICK = 'RESPONSE_TYPE_MULTIPLMOUSECLICK';
    var RESPONSE_TYPE_RADIOBUTTON = 'RESPONSE_TYPE_RADIOBUTTON';
    var RESPONSE_TYPE_CHECKBOX = 'RESPONSE_TYPE_CHECKBOX';
    var RESPONSE_TYPE_INPUT = 'RESPONSE_TYPE_INPUT';
    var RESPONSE_TYPE_TEXTAREA = 'RESPONSE_TYPE_TEXTAREA';
    var RESPONSE_TYPE_RICHTEXT = 'RESPONSE_TYPE_RICHTEXT';
    var RESPONSE_TYPE_SOUND_SWITCH = 'RESPONSE_TYPE_SOUND_SWITCH';
    var RESPONSE_TYPE_SOUND = 'RESPONSE_TYPE_SOUND';
    var RESPONSE_TYPE_DATE = 'RESPONSE_TYPE_DATE';


    /***********************************[util.js]***********************************/

    /*
IE是不支持在setTimeout中给被调用的函数传参数的，为了兼容各个浏览器，我们可以把函数调用参数包裹进新的匿名函数中。示例：
        function f(a){
            alert(a);
        }
        var str={};
        setTimeout(function(){f(str)},50); //通用

        example:
        var trial={};
        setTimeout(show_blank, 2500,trial);
*/
    function overrideTM() {
        if (!+[1,]) {
            (function (overrideFun) {
                window.setTimeout = overrideFun(window.setTimeout);
                window.setInterval = overrideFun(window.setInterval);
            })(
                function (originalFun) {
                    return function (code, delay) {
                        var args = [].slice.call(arguments, 2);
                        return originalFun(
                            function () {
                                if (typeof code == 'string') {
                                    eval(code);
                                }
                                else {
                                    code.apply(this, args);
                                }
                            },
                            delay
                        )
                    }
                }
            );
        }
    }

    overrideTM();

    function exec_func_util(func_name, func_param_name, callback)//string,anytype
    {
        var temp_func_name = function (data) {
        };
        //try{
        temp_func_name = eval(func_name);
        temp_func_name(func_param_name, callback);
        //}catch(e)
        //{
        //$('body').html(JSON.stringify(callback)+'______'+e);
        //alert('func_name='+func_name+'  func_param_name='+func_param_name+'  callback='+callback+' not defined. '+ e);
        //}

    }

    function invoke_callback(callbackargs) {

        //------------callback----------------
        //alert(callbackargs);
        //alert(callbackargs);
        //return;
        var callback = callbackargs.callback;
        exec_func_util(callback.func_name, callback.params, callback);
    }

    function getTimestamp() {
        var now = new Date();
        return now.getTime(); // in ms
    }

    //been tested
    function shuffle_all_items(all_items) {
        var random_items = new Array();
        var item_count = all_items.length;
        for (var i = 0; i < item_count; i++) {
            if (all_items.length == 0) {
                break;
            } else {
                var rani = getRandomInt(all_items.length);
                var deli = all_items.splice(rani, 1);// 删除从指定位置deletePos开始的指定数量deleteCount的元素，数组形式返回所移除的元素
                if (deli.length > 0) {
                    random_items.push(deli[0]);
                } else {
                    alert('function: shuffle_all_items: deli.length=' + deli.length);
                }
            }
        }
        all_items.splice(0, all_items.length);//清空数组
        for (var i = 0; i < random_items.length; i++) {
            all_items.push(random_items[i]);
        }
        return all_items;
    }

    function sort_by_trialid_all_items(all_items) {
        //$('body').append(JSON.stringify({all_items:all_items}));
        all_items.sort(
            function (a, b) {
                if (a.trialid < b.trialid) return -1;
                if (a.trialid > b.trialid) return 1;
                return 0;
            }
        );
        //$('body').append(JSON.stringify({all_items:all_items}));

    }

    //组块顺序不变，组块内刺激随机
    function shuffle_all_items_in_one_same_trialid(all_items) {
        if (!Array.prototype.shuffle) {
            Array.prototype.shuffle = function () {
                for (var j, x, i = this.length; i; j = parseInt(Math.random() * i), x = this[--i], this[i] = this[j], this[j] = x) ;
                return this;
            };
        }

        var unique_trialids = new Array();
        for (var i = 0; i < all_items.length; i++) {
            //alert(all_items[i].trialid+'___'+unique_trialids+'=____'+$.inArray(all_items[i].trialid, unique_trialids));
            if ($.inArray(all_items[i].trialid, unique_trialids) == -1) {
                unique_trialids.push(all_items[i].trialid);
            }
        }

        var temp_all_items = [];
        for (var i = 0; i < unique_trialids.length; i++) {
            var temptrid = unique_trialids[i];
            var tempids = new Array();
            for (var k = 0; k < all_items.length; k++) {
                if (all_items[k].trialid == temptrid) {
                    tempids.push(all_items[k].id);
                }
            }
            //alert(tempids);
            tempids.shuffle();
            //alert(tempids);
            for (var t = 0; t < tempids.length; t++) {
                for (var k = 0; k < all_items.length; k++) {
                    if (all_items[k].id == tempids[t]) {
                        temp_all_items.push(all_items[k]);
                    }
                }
            }
        }

        all_items = temp_all_items;
        return all_items;

    }

    //组块顺序随机，组块内刺激随机
    function shuffle_all_items_block_random_itemsofblock_random(all_items) {
        all_items = shuffle_by_trialid_all_items(all_items);//组块顺序随机
        all_items = shuffle_all_items_in_one_same_trialid(all_items);//组块内刺激随机

        return all_items;

    }

    function shuffle_by_trialid_all_items(all_items) {
        if (!Array.prototype.shuffle) {
            Array.prototype.shuffle = function () {
                for (var j, x, i = this.length; i; j = parseInt(Math.random() * i), x = this[--i], this[i] = this[j], this[j] = x) ;
                return this;
            };
        }

        var unique_trialids = new Array();
        for (var i = 0; i < all_items.length; i++) {
            //alert(all_items[i].trialid+'___'+unique_trialids+'=____'+$.inArray(all_items[i].trialid, unique_trialids));
            if ($.inArray(all_items[i].trialid, unique_trialids) == -1) {
                unique_trialids.push(all_items[i].trialid);
            }
        }

        //alert(unique_trialids);
        unique_trialids.shuffle();
        //alert(unique_trialids);

        var temp_all_items = [];
        for (var i = 0; i < unique_trialids.length; i++) {
            var temtrialid = unique_trialids[i];
            for (var k = 0; k < all_items.length; k++) {
                if (all_items[k].trialid == temtrialid) {
                    var tempobj = {};
                    $.extend(true, tempobj, all_items[k]);
                    temp_all_items.push(tempobj);
                }
            }
        }
        //alert(JSON.stringify({temp_all_items:temp_all_items}));
        /*all_items.splice(0,all_items.length);//清空数组
	for(var i=0;i<temp_all_items.length;i++)
	{
		all_items.push(temp_all_items[i]);
	}*/

        //all_items=[];
        all_items = temp_all_items;
        return all_items;

    }

    //Math.floor(Math.random()*(max-min+1)+min);//[min, max], contains min and contains max
    function getRandomInt(X) {
        return Math.floor(X * (Math.random() % 1));
    }

    /*
function bind_key(proobj)
{
	Mousetrap.bind('p', function() { show_answer(proobj,'p'); });
	Mousetrap.bind('q', function() { show_answer(proobj,'q'); });
}
function unbind_key()
{
	Mousetrap.unbind('p');
	Mousetrap.unbind('q');
}
function reset_all_key()
{
	Mousetrap.reset();
}
*/

    //-----------------------progressbar----------------------------


    //var barobj={width:'600px',height:'30px',duration:5000,update_interval:60};
    function show_progress_bar_util(barobj) {
        var starttime = new Date().getTime();
        var progressbarid = 'progress_bar_' + starttime;
        var progresslabelid = 'progress_label_' + starttime;
        $("#" + progressbarid).remove();

        var progress_div = '<div id="' + progressbarid + '"><div id="' + progresslabelid + '">Loading...</div></div>';
        $("#opes_cotainer_div").append(progress_div);

        $("#" + progressbarid).css({
            'width': barobj.width,
            'height': barobj.height
        });
        $("#" + progresslabelid).css({
            'position': 'absolute',
            'left': '50%',
            'top': '6px',
            'font-weight': 'bold',
            'font-size': '20px',
            'text-shadow': '1px 1px 0 #fff'
        });
        $('#' + progressbarid).position({
            my: 'center top',
            at: 'center top',
            collision: "none",
            of: $(document)
        });

        $("#" + progressbarid).progressbar({
            value: 0
        });

        barobj.timeout_id = null;
        barobj.starttime = starttime;
        barobj.progressbarid = progressbarid;
        barobj.progresslabelid = progresslabelid;
        update_progress_bar_util(barobj);
    }

    function update_progress_bar_util(barobj) {
        if ($("#" + barobj.progressbarid).length == 0) {
            return;
        }
        var now = new Date();
        var time = now.getTime();
        var elapset = (time - barobj.starttime);
        if (elapset < barobj.duration) {
            var showv = parseInt(elapset * 100 / barobj.duration);
            $("#" + barobj.progressbarid).progressbar("option", "value", showv);
            $("#" + barobj.progresslabelid).text($("#" + barobj.progressbarid).progressbar("value") + "%");
            if (barobj.timeout_id != null) {
                clearTimeout(barobj.timeout_id);
            }
            timeout_id = window.setTimeout(update_progress_bar_util, barobj.update_interval, barobj);

        } else {
            $("#" + barobj.progressbarid).progressbar("option", "value", 100);
            $("#" + barobj.progresslabelid).text("100%");
            $("#" + barobj.progressbarid).remove();
        }
    }


    function invoke_proxy(data, success_callback) {
        $.ajax({
            type: "POST",
            async: true,
            cache: false,
            dataType: "json",//which is expected from the sever
            url: "/lattice/CommonActionProxy",
            data: data,
            beforeSend: function (XMLHttpRequestObject) {
            },
            success: function (rdata, textStatus, XMLHttpRequest) {
                //alert($.isEmptyObject(rdata));
                //if 200 ok, Even if the server do not return json object (e.g. return nothing), it will go into this success function.
                success_callback(rdata);
            },
            error: function (jqXHR, textStatus, errorThrown) {
            },
            complete: function (jqXHR, textStatus) {
            }
        });
    }

    /***********************************   GetRequest() ********************************************/

    function GetRequest() {
        var url = location.search;
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }

    /***********************************  时间对象的格式化; ********************************************/

    Date.prototype.format = function (format) {
        /*
     * 使用例子:format="yyyy-MM-dd hh:mm:ss";
     */
        var o = {
            "M+": this.getMonth() + 1, // month
            "d+": this.getDate(), // day
            "h+": this.getHours(), // hour
            "m+": this.getMinutes(), // minute
            "s+": this.getSeconds(), // second
            "q+": Math.floor((this.getMonth() + 3) / 3), // quarter
            "S": this.getMilliseconds()
            // millisecond
        }

        if (/(y+)/.test(format)) {
            format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4
                - RegExp.$1.length));
        }

        for (var k in o) {
            if (new RegExp("(" + k + ")").test(format)) {
                format = format.replace(RegExp.$1, RegExp.$1.length == 1
                    ? o[k]
                    : ("00" + o[k]).substr(("" + o[k]).length));
            }
        }
        return format;
    }

    /***********************************    tips() ********************************************/
    function tips(message) {
        var temts = getTimestamp();
        var alert_div_id = 'RANDOM_ALERT_DIV_ID_JQUERYUI' + temts;
        $('body').append("<div id='" + alert_div_id + "' title='系统信息提示'>" + message + "</div>");
        $('#' + alert_div_id).dialog({
            resizable: false,
            autoOpen: true,
            height: 210,
            width: 390,
            modal: true,
            buttons: {
                '关闭窗口': function () {
                    $('#' + alert_div_id).dialog('close');
                    $('#' + alert_div_id).remove();
                }
            }
        });

    }
    /***********************************[prepare_opes_results.js]***********************************/

    var opes_result_data = {
        taskid: -1,
        projectid: -1,
        coid: 0,
        redirectURLAfterPostResult: ''
    };


    function post_result() {
        //clear up all the timeout IDs for all the data rows
        //NOTE:!!! The start point name sometimes if not OPES_T1 (e.g. if delete the start and then add it)
        //TODO: use OPES_T_START instead. (pre-check if it is defined for old tests). see source code of the web page to check if this OPES_T_START is defined.
        prepare_opes_result_js_clearAllTimeOutIDs(OPES_T1);

        //$('body').html(JSON.stringify(OPES_T1));
        //	return;

        //先暂时屏蔽  -- 练习功能
        //prepare_opes_results_js_saveFileToLocal();

        // var argsdata = {};
        // var data = {
        //     clazz: 'com.lattice.action.proxy.opes.page.redirect.PageRedirectProxy',
        //     service: 'getRedirectURL',
        //     args: JSON.stringify(argsdata)
        // };

        //$('body').html('正在提交数据，第一阶段（获取返回的URL）请稍等...');
        //$('body').html(JSON.stringify(OPES_T1));
        //return;

        // var success = function (rdata) {
        //     opes_result_data.coid = rdata.coid;
        //     opes_result_data.taskid = rdata.taskid;
        //     opes_result_data.projectid = rdata.projectid;
        //     if (GetRequest().targetpagename != null) {
        //         opes_result_data.redirectURLAfterPostResult = "http://www.dweipsy.com/lattice/" + GetRequest().targetpagename;
        //     } else {
        //         opes_result_data.redirectURLAfterPostResult = rdata.url;
        //     }
        //
        //     parepare_and_post();
        // };
        // invoke_proxy(data, success);
    }

    function parepare_and_post() {
        //NOTE:!!! The start point name sometimes if not OPES_T1 (e.g. if delete the start and then add it)
        //$('body').html(JSON.stringify(OPES_T1));

        var all_data = prepare_opes_all_data_from_flows(OPES_T1);
        all_data = prepare_opes_results_js_filterHasBeenShownOnScreenRows(all_data);
        all_data = prepare_opes_results_js_filterNoUserResultRows(all_data);
        prepare_opes_results_js_changeUnresponsedUsertimeToZeroRows(all_data);
        prepare_opes_result_variable(all_data);
        prepare_opes_result_data();

        //$('body').html(JSON.stringify({OPES_T1:OPES_T1,all_data:all_data,opes_result_data:opes_result_data}));
        //return;

        $.ajax({
            type: "POST",
            async: true,
            cache: false,
            //dataType:"json",//which is expected from the sever
            url: "/lattice/OPESHandler?type=formal",
            data: opes_result_data,
            beforeSend: function (XMLHttpRequestObject) {
                $('body').html('正在提交数据，第二阶段（提交结果数据）请稍等...');
            },
            success: function (rdata, textStatus, XMLHttpRequest) {
            },
            complete: function (jqXHR, textStatus) {
                //as this is ajax call, so the OPESHandler redirect will not use.
                window.location.href = opes_result_data.redirectURLAfterPostResult;
            }
        });
    }

    /*
 * one test may contains several data tool, as OPESHandler can only accept one data array, combine all data
 */
    function prepare_opes_all_data_from_flows(OPES_T1) {
        //var blockSize_Accumulate=0;
        var all_data = [];
        var tempcallback = OPES_T1;
        //as the stimid=rowid, if there are 2 data_, the rowid are duplicate, make sure the stimid are unique, will reset the rowid
        //var temp_stimid=1;
        while ((tempcallback) != null) {
            if (tempcallback.func_name == 'data_') {
                var rowList = tempcallback.params.data_row_list;

                for (var i = 0; i < rowList.length; i++) {
                    if (rowList[i].logResultFlag == 1 && rowList[i].hasBeenShownOnScreen == true) {
                        var sindata = rowList[i];

                        /*sindata.id=temp_stimid;
					temp_stimid++;
					*/

                        //sindata.id=rowList[i].id+blockSize_Accumulate;

                        /*
					sindata.answer=rowList[i].correctResult;
					sindata.user_answer=rowList[i].userResult;
					sindata.rowType=rowList[i].rowType;
					*/
                        all_data.push(sindata);
                    }
                }

                //blockSize_Accumulate=blockSize_Accumulate+rowList.length;

            }

            tempcallback = tempcallback.callback;
        }

        return all_data;

    }

    //clear all timeout id before post the result
    function prepare_opes_result_js_clearAllTimeOutIDs(OPES_T1) {
        var tempcallback = OPES_T1;
        while ((tempcallback) != null) {
            if (tempcallback.func_name == 'data_') {
                var rowList = tempcallback.params.data_row_list;

                for (var i = 0; i < rowList.length; i++) {
                    var current_row = rowList[i];
                    if (current_row.rowTimeoutID != null) {
                        clearTimeout(current_row.rowTimeoutID);
                        console.log('Clean up current_row.rowTimeoutID=' + current_row.rowTimeoutID);
                    }
                    if (current_row.timeoutIDForRowFeedbackAliveTime != null) {
                        clearTimeout(current_row.timeoutIDForRowFeedbackAliveTime);
                        console.log('Clean up current_row.timeoutIDForRowFeedbackAliveTime=' + current_row.timeoutIDForRowFeedbackAliveTime);
                    }

                    var data_column_list = current_row.data_column_list;
                    for (var c = 0; c < data_column_list.length; c++) {
                        var column = data_column_list[c];
                        if (column.timeoutIDForDelayTime != null) {
                            clearTimeout(column.timeoutIDForDelayTime);
                            console.log('Clean up column.timeoutIDForDelayTime=' + column.timeoutIDForDelayTime);
                        }
                        if (column.timeoutIDForAliveTime != null) {
                            clearTimeout(column.timeoutIDForAliveTime);
                            console.log('Clean up column.timeoutIDForAliveTime=' + column.timeoutIDForAliveTime);
                        }
                    }
                }
            }
            tempcallback = tempcallback.callback;
        }
    }

    function add_result(key, value) {
        opes_result_data[key] = value;
    }

    function prepare_opes_results_js_filterNoUserResultRows(all_data) {
        var new_all_data = [];
        for (var i = 0; i < all_data.length; i++) {
            var sindata = all_data[i];

            if (typeof(sindata.userResult) == "undefined" || sindata.userResult == null) {
                //why ignore this row? someone report if we define custom code exist when wrong 3 rows, but it finally collect 4 rows, last row userResult is null.
            } else {
                new_all_data.push(sindata);
            }
        }
        return new_all_data;
    }

    function prepare_opes_results_js_filterHasBeenShownOnScreenRows(all_data) {
        var new_all_data = [];
        for (var i = 0; i < all_data.length; i++) {
            var sindata = all_data[i];

            if (typeof(sindata.hasBeenShownOnScreen) == "undefined" || sindata.hasBeenShownOnScreen) {
                new_all_data.push(sindata);
            }
        }
        return new_all_data;
    }

    function prepare_opes_results_js_changeUnresponsedUsertimeToZeroRows(all_data) {
        for (var i = 0; i < all_data.length; i++) {
            var sindata = all_data[i];
            if (sindata.userResult == null || sindata.userResult == '') {
                sindata.responseDuration = 0;
            }
        }
    }

    function prepare_opes_result_variable(all_data) {
        add_result("taskid", opes_result_data.taskid);
        add_result("sumitcoids", opes_result_data.coid);
        add_result("targetpagename", 'targetpagename');
        add_result("taskIdentifier", 'crt');
        add_result("projectid", opes_result_data.projectid);

        test_begin_ime = getTimestamp();
        rc_key = [];
        rc_time = [];
        eventonset = [];
        correct_result = [];
        type4All = [];//rowType
        stimidAll = [];//rowid
        //currently we have 4 types for OPES2
        buttonSetAll = [];//keyboard, e.g. P Q
        numberSetAll = [];//integer input
        commentSetAll = [];//text input
        radioSetAll = [];//radiobox and checkbox

        radiolist1setAll = [];//score list for one stimulate/row
        radiolist2setAll = [];
        radiolist3setAll = [];
        radiolist4setAll = [];
        radiolist5setAll = [];
        radiolist6setAll = [];
        radiolist7setAll = [];
        radiolist8setAll = [];
        radiolist9setAll = [];
        radiolist10setAll = [];

        for (var i = 0; i < all_data.length; i++) {
            var sindata = all_data[i];
            rc_key.push(sindata.userResult);

            rc_time.push(sindata.responseDuration);
            eventonset.push(sindata.eventOnset);

            correct_result.push(sindata.correctResult);
            type4All.push(sindata.rowType);
            stimidAll.push(sindata.id);

            //alert(sindata.responseType);
            //alert(sindata.responseDuration);
            //alert(sindata.correctResult);

            if (sindata.responseType == 'RESPONSE_TYPE_RADIOBUTTON' || sindata.responseType == 'RESPONSE_TYPE_CHECKBOX') {
                //sindata.options=rowList[i].options;
                radioSetAll.push(sindata.userResult);
                numberSetAll.push(sindata.userResult);
                commentSetAll.push(sindata.comment);
                buttonSetAll.push(sindata.userResult);

                //radioSetAll.push('');
                //numberSetAll.push(sindata.userResult);
                //commentSetAll.push('');
                //buttonSetAll.push('');


                var data_column_list = sindata.data_column_list;
                for (var k = 0; k < data_column_list.length; k++)//there should be error when there are more than 1 STIMULATE_TYPE_RADIOBUTTON columns in 1 row
                {
                    var column = data_column_list[k];
                    if (column.stimulateType == 'STIMULATE_TYPE_RADIOBUTTON') {
                        var options = column.options;
                        //alert(options.length);
                        //return;
                        if (options.length == 1) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push('');
                            radiolist3setAll.push('');
                            radiolist4setAll.push('');
                            radiolist5setAll.push('');
                            radiolist6setAll.push('');
                            radiolist7setAll.push('');
                            radiolist8setAll.push('');
                            radiolist9setAll.push('');
                            radiolist10setAll.push('');
                        } else if (options.length == 2) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push('');
                            radiolist4setAll.push('');
                            radiolist5setAll.push('');
                            radiolist6setAll.push('');
                            radiolist7setAll.push('');
                            radiolist8setAll.push('');
                            radiolist9setAll.push('');
                            radiolist10setAll.push('');

                        } else if (options.length == 3) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push(options[2].score);
                            radiolist4setAll.push('');
                            radiolist5setAll.push('');
                            radiolist6setAll.push('');
                            radiolist7setAll.push('');
                            radiolist8setAll.push('');
                            radiolist9setAll.push('');
                            radiolist10setAll.push('');
                        } else if (options.length == 4) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push(options[2].score);
                            radiolist4setAll.push(options[3].score);
                            radiolist5setAll.push('');
                            radiolist6setAll.push('');
                            radiolist7setAll.push('');
                            radiolist8setAll.push('');
                            radiolist9setAll.push('');
                            radiolist10setAll.push('');
                        } else if (options.length == 5) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push(options[2].score);
                            radiolist4setAll.push(options[3].score);
                            radiolist5setAll.push(options[4].score);
                            radiolist6setAll.push('');
                            radiolist7setAll.push('');
                            radiolist8setAll.push('');
                            radiolist9setAll.push('');
                            radiolist10setAll.push('');
                        } else if (options.length == 6) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push(options[2].score);
                            radiolist4setAll.push(options[3].score);
                            radiolist5setAll.push(options[4].score);
                            radiolist6setAll.push(options[5].score);
                            radiolist7setAll.push('');
                            radiolist8setAll.push('');
                            radiolist9setAll.push('');
                            radiolist10setAll.push('');

                        } else if (options.length == 7) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push(options[2].score);
                            radiolist4setAll.push(options[3].score);
                            radiolist5setAll.push(options[4].score);
                            radiolist6setAll.push(options[5].score);
                            radiolist7setAll.push(options[6].score);
                            radiolist8setAll.push('');
                            radiolist9setAll.push('');
                            radiolist10setAll.push('');
                        } else if (options.length == 8) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push(options[2].score);
                            radiolist4setAll.push(options[3].score);
                            radiolist5setAll.push(options[4].score);
                            radiolist6setAll.push(options[5].score);
                            radiolist7setAll.push(options[6].score);
                            radiolist8setAll.push(options[7].score);
                            radiolist9setAll.push('');
                            radiolist10setAll.push('');
                        } else if (options.length == 9) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push(options[2].score);
                            radiolist4setAll.push(options[3].score);
                            radiolist5setAll.push(options[4].score);
                            radiolist6setAll.push(options[5].score);
                            radiolist7setAll.push(options[6].score);
                            radiolist8setAll.push(options[7].score);
                            radiolist9setAll.push(options[8].score);
                            radiolist10setAll.push('');
                        } else if (options.length == 10) {
                            radiolist1setAll.push(options[0].score);
                            radiolist2setAll.push(options[1].score);
                            radiolist3setAll.push(options[2].score);
                            radiolist4setAll.push(options[3].score);
                            radiolist5setAll.push(options[4].score);
                            radiolist6setAll.push(options[5].score);
                            radiolist7setAll.push(options[6].score);
                            radiolist8setAll.push(options[7].score);
                            radiolist9setAll.push(options[8].score);
                            radiolist10setAll.push(options[9].score);
                        } else {
                            alert('TODO for options.length=' + options.length + ' of prepare_opes_result_variable().');
                        }
                    } else if (column.stimulateType == 'RESPONSE_TYPE_CHECKBOX') {
                        //RESPONSE_TYPE_CHECKBOX no need to calculate score
                    }
                }

            } else {
                radiolist1setAll.push('');
                radiolist2setAll.push('');
                radiolist3setAll.push('');
                radiolist4setAll.push('');
                radiolist5setAll.push('');
                radiolist6setAll.push('');
                radiolist7setAll.push('');
                radiolist8setAll.push('');
                radiolist9setAll.push('');
                radiolist10setAll.push('');
            }
            if (sindata.responseType == 'RESPONSE_TYPE_INPUT') {
                var inputType = prepare_opes_result_getInputType(sindata);
                //alert(inputType);
                if (inputType == 'INPUT_TYPE_NUMBER') {
                    radioSetAll.push('');
                    numberSetAll.push(sindata.userResult);
                    commentSetAll.push(sindata.comment);
                    buttonSetAll.push('');
                } else if (inputType == 'INPUT_TYPE_TEXT') {
                    radioSetAll.push('');
                    numberSetAll.push('');
                    commentSetAll.push(sindata.comment);
                    buttonSetAll.push(sindata.userResult);
                } else if (inputType == 'INPUT_TYPE_COMMENTS') {
                    radioSetAll.push('');
                    numberSetAll.push('');
                    commentSetAll.push(sindata.comment);
                    buttonSetAll.push('');
                } else {
                    radioSetAll.push('CAN_NOT_FIND_CORRECT_INPUT_TYPE');
                    numberSetAll.push('CAN_NOT_FIND_CORRECT_INPUT_TYPE');
                    commentSetAll.push('CAN_NOT_FIND_CORRECT_INPUT_TYPE');
                    buttonSetAll.push('CAN_NOT_FIND_CORRECT_INPUT_TYPE');
                }
            }

            if (sindata.responseType == 'RESPONSE_TYPE_SINGLEKEY') {
                buttonSetAll.push(sindata.userResult);
                commentSetAll.push(sindata.comment);
                numberSetAll.push('');
                radioSetAll.push('');
            }
            if (sindata.responseType == 'RESPONSE_TYPE_TEXTAREA') {
                buttonSetAll.push('');
                numberSetAll.push('');
                commentSetAll.push(sindata.comment);
                radioSetAll.push('');
            }

        }


    }

    function prepare_opes_result_getInputType(dataRow) {
        var inputType = null;
        var data_column_list = dataRow.data_column_list;
        for (var k = 0; k < data_column_list.length; k++)//there should be error when there are more than 1 STIMULATE_TYPE_INPUT columns in 1 row
        {
            var column = data_column_list[k];
            //alert(column.inputType+'___'+(column.stimulateType=='STIMULATE_TYPE_INPUT'))
            if (column.stimulateType == 'STIMULATE_TYPE_INPUT') {
                inputType = column.inputType;
                break;
            }
        }
        if (inputType == null) {
            tips('实验设置错误：实验相应设置为RESPONSE_TYPE_INPUT，但是在实验里面没有设置STIMULATE_TYPE_INPUT！刺激行号：ROWID=' + dataRow.id);
        }
        return inputType;
    }

    /*****this function is leave unchanged, copied from cftF.jsp********/
    function prepare_opes_result_data() {
        add_result("user_result", rc_key.join(';'));
        add_result("user_time", rc_time.join(';'));
        add_result("eventonsetset", eventonset.join(';'));

        add_result("correct_result", correct_result.join(';'));
        add_result("duration", getTimestamp() - test_begin_ime);

        var type4set = type4All.join(";");
        var stimidset = stimidAll.join(";");
        var correctanswerset = correct_result.join(";");
        var buttonset = rc_key.join(";");
        var timeset = rc_time.join(";");
        var eventonsetset = eventonset.join(";");
        var timeaverage = getTimestamp() - test_begin_ime;
        add_result("type4set", type4set);
        add_result("stimidset", stimidset);
        add_result("correctanswerset", correctanswerset);
        add_result("buttonset", buttonset);
        add_result("timeset", timeset);
        add_result("eventonsetset", eventonsetset);

        add_result("timeaverage", timeaverage);
        var numset = numberSetAll.join(";");
        var radioset = radioSetAll.join(";");
        var commentset = commentSetAll.join(";");
        add_result("numset", numset);
        add_result("radioset", radioset);
        add_result("commentset", commentset);
        var radiolist1set = radiolist1setAll.join(";");//score list for one stimulate/row
        var radiolist2set = radiolist2setAll.join(";");
        var radiolist3set = radiolist3setAll.join(";");
        var radiolist4set = radiolist4setAll.join(";");
        var radiolist5set = radiolist5setAll.join(";");
        var radiolist6set = radiolist6setAll.join(";");
        var radiolist7set = radiolist7setAll.join(";");
        var radiolist8set = radiolist8setAll.join(";");
        var radiolist9set = radiolist9setAll.join(";");
        var radiolist10set = radiolist10setAll.join(";");

        var countOfCorrectNumber_ByType = getCorrectCountSortByType(
            numset, correctanswerset, type4set);
        var countOfCorrectButton_ByType = getCorrectCountSortByType(
            buttonset, correctanswerset, type4set);
        var countOfCorrectRadio_ByType = getCorrectCountSortByType(
            radioset, correctanswerset, type4set);
        var countOfCorrectButton_ByType_Corrected = getCorrectCountSortByType_Corrected(
            buttonset, correctanswerset, type4set);
        var percentageCorrectNumber_ByType = getPercentageCorreceSortByType(
            numset, correctanswerset, type4set);
        var percentageCorrectButton_ByType = getPercentageCorreceSortByType(
            buttonset, correctanswerset, type4set);
        var percentageCorrectRadio_ByType = getPercentageCorreceSortByType(
            radioset, correctanswerset, type4set);
        var meanNumber_ByType = getMeanSortByType(numset, type4set);
        var sumNumber_ByType = getSumSortByType(numset, type4set);
        var meanRT_ByType = getMeanSortByType(timeset, type4set);
        var meanDeviationNumber_ByType = getMeanDeviationSortByType(
            numset, correctanswerset, type4set);
        var sumWeightedRadio_ByType = getWeightedScoreSortByType(
            radioset, type4set, radiolist1set, radiolist2set,
            radiolist3set, radiolist4set, radiolist5set,
            radiolist6set, radiolist7set, radiolist8set,
            radiolist9set, radiolist10set);
        var type4_Unique = getType(type4set);


        var medianRTButton_ByType_Corrected = getMedianSortByType_Corrected(buttonset, correctanswerset, timeset, type4set);
        add_result("medianRTButton_ByType_Corrected", medianRTButton_ByType_Corrected);
        add_result("countOfCorrectNumber_ByType",
            countOfCorrectNumber_ByType);
        add_result("countOfCorrectButton_ByType",
            countOfCorrectButton_ByType);
        add_result("countOfCorrectRadio_ByType",
            countOfCorrectRadio_ByType);
        add_result("countOfCorrectButton_ByType_Corrected",
            countOfCorrectButton_ByType_Corrected);
        add_result("percentageCorrectNumber_ByType",
            percentageCorrectNumber_ByType);
        add_result("percentageCorrectButton_ByType",
            percentageCorrectButton_ByType);
        add_result("percentageCorrectRadio_ByType",
            percentageCorrectRadio_ByType);
        add_result("meanNumber_ByType", meanNumber_ByType);
        add_result("sumNumber_ByType", sumNumber_ByType);
        add_result("meanRT_ByType", meanRT_ByType);
        add_result("meanDeviationNumber_ByType",
            meanDeviationNumber_ByType);
        add_result("sumWeightedRadio_ByType", sumWeightedRadio_ByType);
        add_result("type4_Unique", type4_Unique);

        //document.getElementById("result").submit();

    }

    function prepare_opes_results_js_saveFileToLocal() {
        var now = new Date();
        var currentTS = now.getTime()
        var currentDate = $.datepicker.formatDate('yy-mm-dd', new Date());
        var currentTime = $.datepicker.formatDate('hh:mm:ss', new Date());

        var url = window.location.href;//http://localhost:8080/lattice/experiments/opes2/36/3995/3995.html
        var paths = url.split("/");
        var uid = paths[paths.length - 3];
        var taskid = paths[paths.length - 2];

        var fileName = 'opes_local_results_' + uid + '_' + taskid + '_' + currentDate + '_' + currentTS + ".csv";
        //alert(fileName);

        var tempRawDataAndResults = prepare_opes_results_js_getResultContent();

        if ($.browser.msie) {
            //TODO, use IE object active ? need to discuss later.
            saveTextAs(tempRawDataAndResults, fileName);
        } else {
            var file = new Blob([tempRawDataAndResults], {type: "text/plain;charset=utf-8"});
            saveAs(file, fileName);
        }
    }

    function prepare_opes_results_js_getResultContent() {
        var content = "";

        var all_data = prepare_opes_all_data_from_flows(OPES_T1);
        all_data = prepare_opes_results_js_filterHasBeenShownOnScreenRows(all_data);
        prepare_opes_results_js_changeUnresponsedUsertimeToZeroRows(all_data);
        prepare_opes_result_variable(all_data);
        prepare_opes_result_data();

        var currentDateTime = new Date().format("yyyy-MM-dd hh:mm:ss");
        //alert(currentDateTime);
        var url = window.location.href;//http://localhost:8080/lattice/experiments/opes2/36/3995/3995.html?projectid=1284
        var paths = url.split("/");
        var uid = paths[paths.length - 3];
        var taskid = paths[paths.length - 2];
        var projectid = GetRequest().projectid;


        var head = "Sub-Collective,Resultid,Userid,Username,Realname,Taskid,Radioset,Buttonset,Numberset,Commentset,Timeset,Correctanswerset,Timeraverage,Average,Testtime,Stimidset,Istest,Duration,Userage,Adminflag,Numberofcorrecttrial,Originalscore,Standardscore,Percentile,Stannine,Type4set,Charge,ProjectID,Experimenterid,Eventonsetset";
        content += head + "\n";

        var tempRawDataAndResults = JSON.stringify(opes_result_data);
        //content+=tempRawDataAndResults+"\n";

        content += "0,";
        content += "0,";
        content += uid + ",";
        content += "0,";
        content += "0,";
        content += taskid + ",";

        content += opes_result_data.radioset + ",";
        content += opes_result_data.buttonset + ",";
        content += opes_result_data.numset + ",";
        content += opes_result_data.commentset + ",";
        content += opes_result_data.timeset + ",";
        content += opes_result_data.correctanswerset + ",";
        content += opes_result_data.timeaverage + ",";
        content += "0,";//content+=opes_result_data.average+",";
        content += currentDateTime + ",";//content+=opes_result_data.testtime+",";
        content += opes_result_data.stimidset + ",";
        content += "0,";//content+=opes_result_data.Istest
        content += opes_result_data.duration + ",";
        content += "0,";//content+=opes_result_data.Userage
        content += "0,";//content+=opes_result_data.Adminflag
        content += "0,";//content+=opes_result_data.Numberofcorrecttrial
        content += "0,";//content+=opes_result_data.Originalscore
        content += "0,";//content+=opes_result_data.Standardscore
        content += "0,";//content+=opes_result_data.Percentile
        content += "0,";//content+=opes_result_data.Stannine
        content += opes_result_data.type4set + ",";
        content += "0,";//content+=opes_result_data.Charge
        content += projectid + ",";
        content += "0,";//content+=opes_result_data.Experimenterid
        content += opes_result_data.eventonsetset;


        //方法1：添加一个功能， 每个用户再重新上传一次
        //方法2：添加一个功能，系统管理员分个重新上传


        return content;
    }

    /***********************************[start_preload_img_sound.js]***********************************/

    function start_preload_img_sound_js_doPreLoad_(fundata, callbackargs) {
        var proobj = {};
        proobj.fundata = fundata;
        proobj.callbackargs = callbackargs;
        var imgSrcList = start_preload_img_sound_js_getAllImageSrcList_(proobj);
        ____tempImageObjetListForCacheOnlyWillNotBeUsed = start_preload_img_sound_js_loadImages_(imgSrcList, callbackargs);
    }

    function start_preload_img_sound_js_getAllImageSrcList_(proobj) {
        var imgSrcList = [];

        var tempCallback = proobj.callbackargs.callback;
        while (tempCallback != null) {
            if (tempCallback.func_name == 'data_') {
                //alert(tempCallback.func_name);

                start_preload_img_sound_js_getImgSrcForEachDataStage(tempCallback.params, imgSrcList);
            }

            tempCallback = tempCallback.callback;
        }


        return imgSrcList;
    }

    function start_preload_img_sound_js_getImgSrcForEachDataStage(dataParams, imgSrcList) {
        var data_row_list = dataParams.data_row_list;
        for (var r = 0; r < data_row_list.length; r++) {
            var current_row = data_row_list[r];
            var data_column_list = current_row.data_column_list;
            for (var i = 0; i < data_column_list.length; i++) {
                var column = data_column_list[i];
                if (column.stimulateType == STIMULATE_TYPE_IMAGE) {
                    imgSrcList.push(column.src);
                } else if (column.stimulateType == STIMULATE_TYPE_SOUND) {
                    //alert('TODO: for preloading STIMULATE_TYPE_SOUND in data_preload_img_sound.js');
                } else if (column.stimulateType == STIMULATE_TYPE_FLASH) {
                    alert('TODO: for preloading STIMULATE_TYPE_FLASH in data_preload_img_sound.js');
                } else if (column.stimulateType == STIMULATE_TYPE_VIDEO) {
                    alert('TODO: for preloading STIMULATE_TYPE_VIDEO in data_preload_img_sound.js');
                }
            }//end column list loop

        }//end row list loop
    }

    function start_preload_img_sound_js_loadImages___________NOTUSED(imgSrcList, callbackargs) {
        var progress = 0;
        var tempImageObjetList = [];
        for (var i = 0; i < imgSrcList.length; i++) {
            tempImageObjetList[i] = new Image();
            tempImageObjetList[i].onload = function () {
                progress++;
                var tempercent = Math.round(progress / imgSrcList.length * 100);
                $('#opes_cotainer_div').append('正在预加载材料 （' + tempercent + '%）...');
                if (tempercent == 100) {
                    window.setTimeout(invoke_callback, 30, callbackargs);
                }
            }
            tempImageObjetList[i].onerror = function () {
                progress++;
                var tempercent = Math.round(progress / imgSrcList.length * 100);
                $('#opes_cotainer_div').append('正在预加载材料 （' + tempercent + '%）...');
                if (tempercent == 100) {
                    window.setTimeout(invoke_callback, 30, callbackargs);
                }
            }
            tempImageObjetList[i].src = imgSrcList[i];
        }
        return tempImageObjetList;
    }

    var GLOBAL_PRE_LOAD_COUNT = 0;

    function start_preload_img_sound_js_loadImages_(imgSrcList, callbackargs) {
        var tempImageObjetList = [];
        var start = getTimestamp();
        var duration = 1;//seconds
        var totalcount = imgSrcList.length;
        start_preload_img_sound_js_kickoff_interval_updater_(start, duration, totalcount, callbackargs);

        for (var i = 0; i < imgSrcList.length; i++) {
            tempImageObjetList[i] = new Image();
            tempImageObjetList[i].onload = function () {
                GLOBAL_PRE_LOAD_COUNT++;
                //$("body").append(this.src+' onload.');
            }
            tempImageObjetList[i].onerror = function () {
                GLOBAL_PRE_LOAD_COUNT++;
                //$("body").append(this.src+' onerror.');
            }
            tempImageObjetList[i].src = imgSrcList[i];
        }
        return tempImageObjetList;
    }

    /****************************预加载进度条************************************/
    /*
* 进度显示采用哪个值低用哪个的原则：
* 1. 如果加载进度是10%，默认10s的进度是20%，那么用10%
* 2. 如果加载进度是90%，默认10s的进度是50%，那么用50%
*/

    function start_preload_img_sound_js_kickoff_interval_updater_(starttime, duration, totalcount, callbackargs) {
        var passobj = {};
        passobj.starttime = starttime;
        passobj.duration = duration;
        passobj.totalcount = totalcount;
        passobj.callbackargs = callbackargs;
        start_preload_img_sound_js_create_progress_bar_if_does_not_exist_();
        start_preload_img_sound_js_dowhile_check_(passobj);

    }

    function start_preload_img_sound_js_dowhile_check_(passobj) {
        var temts = getTimestamp();
        var starttime = passobj.starttime;
        var totalcount = passobj.totalcount;
        var callbackargs = passobj.callbackargs;
        var realProgress = Math.round(GLOBAL_PRE_LOAD_COUNT * 100 / totalcount);
        var duration = passobj.duration;
        var progress = Math.round((temts - starttime) * 100 / (duration * 1000));
        progress = progress > 100 ? 100 : progress;
        if (progress >= realProgress) {
            progress = realProgress;
        }
        start_preload_img_sound_js_update_preload_progress_bar_(progress);
        if (progress < 100) {
            window.setTimeout(start_preload_img_sound_js_dowhile_check_, 1, passobj);
        } else {
            //alert('done');
            window.setTimeout(invoke_callback, 20, callbackargs);
        }

    }

    function start_preload_img_sound_js_update_preload_progress_text_(progress) {
        progress = progress > 100 ? 100 : progress;

        var content = '<span id="start_preload_img_sound_js_update_preload_progress_div_id" style="font-size:24px;font-weight:bold;color:blue;">Loading material... (' + progress + '%)</span>';
        $("#opes_cotainer_div").html(content);
        $('#start_preload_img_sound_js_update_preload_progress_div_id').position({
            my: 'center center',
            at: 'center center',
            of: $(document)
        });


    }

    function start_preload_img_sound_js_create_progress_bar_if_does_not_exist_() {
        var progressbarid = 'start_preload_img_sound_js_update_preload_progress_bar_id';
        var progresslabelid = 'start_preload_img_sound_js_update_preload_progress_label_id';

        if ($('#' + progressbarid).length == 0) {
            var progress_div = '<div id="' + progressbarid + '"><div id="' + progresslabelid + '">Loading...</div></div>';
            $("#opes_cotainer_div").append(progress_div);
            $("#" + progressbarid).css({
                'width': '600px',
                'height': '30px'
            });
            $("#" + progresslabelid).css({
                'position': 'absolute',
                'left': '31%',
                'top': '4px',
                'font-weight': 'bold',
                'font-size': '20px',
                'text-shadow': '1px 1px 0 #fff'
            });
            $('#' + progressbarid).position({
                my: 'center center',
                at: 'center center',
                collision: "none",
                of: $(document)
            });

            $("#" + progressbarid).progressbar({
                value: 0
            });

        }
    }

    function start_preload_img_sound_js_update_preload_progress_bar_(progress) {
        var progressbarid = 'start_preload_img_sound_js_update_preload_progress_bar_id';
        var progresslabelid = 'start_preload_img_sound_js_update_preload_progress_label_id';

        progress = progress > 100 ? 100 : progress;
        $("#" + progressbarid).progressbar("option", "value", progress);
        $("#" + progresslabelid).text("Loading material... (" + $("#" + progressbarid).progressbar("value") + "%)");

    }


    /***********************************[stage.js]***********************************/



    function start_(fundata, callbackargs) {
        //$('body').css({'margin':'0px','background-color':'#000','font-size':'80pt','color':'#FFF','cursor':'url(../../images/empty.cur1), auto'});
        $(document).attr("title", fundata.pagetitle);
        $('body').css({'margin': '0px'});
        $('body').css({'background-color': fundata.pagebackground});
        $('body').css({'font-size': fundata.fontsize});
        $('body').css({'color': fundata.fontcolor});
        if (fundata.mousetype == 'custom_mouse_type') {
            $('body').css({'cursor': 'url(' + fundata.mouse_type_image + '), auto'});
        } else {
            $('body').css({'cursor': fundata.mousetype});
        }
        if (fundata.setbackgroundimg) {
            $('body').css({'background-size': '100%', 'background': 'url(' + fundata.backgroundimgsrc + ') no-repeat'});
        }
        //$('body').css({'cursor':'url(../../images/empty.cur1), auto'});
        //$('body').html('<div style="width:100%;height:100%;" id="opes_cotainer_div"></div>');
        $('body').html('<div style="" id="opes_cotainer_div"></div>');
        if (fundata.doPreload) {
            start_preload_img_sound_js_doPreLoad_(fundata, callbackargs);
        } else {
            window.setTimeout(invoke_callback, 30, callbackargs);
        }
    }

    function data_(fundata, callbackargs) {
        var proobj = {};
        proobj.fundata = fundata;
        proobj.callbackargs = callbackargs;
        show_next_snapshot(proobj);
    }

    function wait_(fundata, callbackargs) {
        var proobj = {};
        proobj.fundata = fundata;
        proobj.callbackargs = callbackargs;
        show_progress_bar(proobj);
    }

    function timer_(fundata, callbackargs) {
        var proobj = {};
        proobj.fundata = fundata;
        proobj.callbackargs = callbackargs;
        timer_js_show_progress_bar(proobj);
    }

    function text_(fundata, callbackargs) {
        $('body').html('');
        $('body').append('<span id="text_id_' + fundata.id + '"></span>');
        $('#text_id_' + fundata.id).html(fundata.text);
        $('#text_id_' + fundata.id).css({
            'font-size': fundata.fontsize,
            'color': fundata.fontcolor,
            'position': 'absolute'
        });
        $('#text_id_' + fundata.id).position({
            my: fundata.position.my,
            at: fundata.position.at,
            of: $(document)
        });

        window.setTimeout(invoke_callback, 2000, callbackargs);
    }

    function end_(fundata, callbackargs) {
        mui.toast('练习结束!2秒后自动跳转正式任务页面!', {duration: 'long', type: 'div'})
        setTimeout(function () {
            mui.openWindow({
                url: '../../../task_1/task_type.html?type=1&practice=true',
                createNew: true,
                styles: {
                    cachemode: "noCache",
                }
            });
        }, 2000);
        // post_result();
    }

    /***********************************[data.js]***********************************/

    /*
运行步骤：

goto next snapshot conditions:
0. the first snapshot
1. time is up for all the columns in the row，this is set in the window.setTimeout(), invoke automatically
2. user key input
3. user button click

*/

    /*
cancel keyboard event conditions:
1. snapshot alive time reaches
2. user type keyboard
3. row alive time reaches
*/

    function show_next_snapshot(proobj) {
        if (proobj.fundata.showtype == 'TEST_TYPE_SURVEY_FORM') {
            data_surveyform_js_showSurveyForm_(proobj.fundata, proobj.callbackargs);
            return;
        }
        $('#opes_cotainer_div').html('');
        proobj.fundata.current_row_index++;

        //var data_row_list=proobj.fundata.data_row_list;
        var randomFlag = proobj.fundata.randomFlag;
        var callback = proobj.callbackargs.callback;
        if (proobj.fundata.data_row_list.length == 0)//no rows, call next stage
        {
            exec_func_util(callback.func_name, callback.params, callback);
            return;
        }
        if (proobj.fundata.current_row_index == 0)//is the first row
        {
            //console.log(proobj.fundata.current_row_index+JSON.stringify(proobj));
            if (randomFlag == 1) {
                shuffle_all_items(proobj.fundata.data_row_list);
            } else if (randomFlag == 2)//sort by trialid
            {
                sort_by_trialid_all_items(proobj.fundata.data_row_list);
            } else if (randomFlag == 3)//shuffle by trialid
            {
                proobj.fundata.data_row_list = shuffle_by_trialid_all_items(proobj.fundata.data_row_list);
            } else if (randomFlag == 4)//Trialid组块顺序不变组块内刺激随机
            {
                //$('body').append(JSON.stringify({before:proobj.fundata.data_row_list}));
                //console.log('['+JSON.stringify(proobj.fundata.data_row_list));
                //alert(proobj.fundata.data_row_list[0].id+'---'+proobj.fundata.data_row_list[0].id);
                proobj.fundata.data_row_list = shuffle_all_items_in_one_same_trialid(proobj.fundata.data_row_list);
                //alert(proobj.fundata.data_row_list[0].id+'---'+proobj.fundata.data_row_list[0].id);
                //console.log(','+JSON.stringify(proobj.fundata.data_row_list+']'));
                //$('body').append(JSON.stringify({after:proobj.fundata.data_row_list}));
                //alert(JSON.stringify({data_row_list_3:data_row_list}));
            } else if (randomFlag == 5)//Trialid组块顺序随机组块内刺激随机
            {
                proobj.fundata.data_row_list = shuffle_all_items_block_random_itemsofblock_random(proobj.fundata.data_row_list);
            }
        } else //not the first row, save previous results
        {
            //save_previous_result(proobj);
            cleanup_all_column_timeout_ids_for_previous_row(proobj);
        }

        if (proobj.fundata.current_row_index == proobj.fundata.data_row_list.length)//all are processed
        {
            exec_func_util(callback.func_name, callback.params, callback);
            return;
        } else  //process next snapshot
        {
            execute_pre_custom_code_ifany(proobj);

            var current_row = proobj.fundata.data_row_list[proobj.fundata.current_row_index];
            current_row.responseStartTime = getTimestamp();
            if (current_row.showTimer == true) {
                var barobj = {width: '600px', height: '30px', duration: current_row.aliveTime, update_interval: 60};
                show_progress_bar_util(barobj);
            }
            //var rowTimeoutID=window.setTimeout(show_next_snapshot,current_row.aliveTime,proobj);
            var passobj = {};
            passobj.proobj = proobj;
            var rowTimeoutID = window.setTimeout(show_row_feedback, current_row.aliveTime, passobj);
            current_row.rowTimeoutID = rowTimeoutID;
            current_row.hasBeenShownOnScreen = true;

            show_all_columns_in_one_row(proobj);
        }
    }

    function cleanup_all_column_timeout_ids_for_previous_row(proobj) {
        //todo: suggest to add clear timeout for current_row.rowTimeoutID
        var data_row_list = proobj.fundata.data_row_list;
        var current_row = data_row_list[proobj.fundata.current_row_index - 1];
        var data_column_list = current_row.data_column_list;
        for (var i = 0; i < data_column_list.length; i++) {
            var column = data_column_list[i];
            if (column.timeoutIDForDelayTime != null) {
                clearTimeout(column.timeoutIDForDelayTime);
            }
            if (column.timeoutIDForAliveTime != null) {
                clearTimeout(column.timeoutIDForAliveTime);
            }
        }
    }

    function reset_all_user_defined_keys() {
        Mousetrap.reset();
    }

    function process_user_response_single_key(proobj, userTypedKey) {
        //record the user response end time once the user type the key
        var data_row_list = proobj.fundata.data_row_list;
        var current_row = data_row_list[proobj.fundata.current_row_index];
        current_row.responseEndTime = getTimestamp();


        userTypedKey = userTypedKey.toLowerCase();
        $('#USER_RESULT_ID').remove();
        $('body').append('<input id="USER_RESULT_ID" type=hidden value="' + userTypedKey + '" />');
        var data_row_list = proobj.fundata.data_row_list;
        var current_row = data_row_list[proobj.fundata.current_row_index];
        if (current_row.aliveType == ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED) {
            if (current_row.rowTimeoutID != null) {
                clearTimeout(current_row.rowTimeoutID);//as goto next snapshot via user click, so clear the goto next snapshot timeOut
            }
            //show_next_snapshot(proobj);
            var passobj = {};
            passobj.proobj = proobj;
            show_row_feedback(passobj);
        }
    }

    function process_user_response_sound_switch() {
        if (temp_Timer_End_Signal_sound_switch == 1) {
            var proobj = temp_proobj_for_sound_switch;
            var data_row_list = proobj.fundata.data_row_list;
            var current_row = data_row_list[proobj.fundata.current_row_index];
            if (current_row.aliveType == ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED) {
                if (current_row.rowTimeoutID != null) {
                    clearTimeout(current_row.rowTimeoutID);//as goto next snapshot via user click, so clear the goto next snapshot timeOut
                }
                //show_next_snapshot(proobj);
                var passobj = {};
                passobj.proobj = proobj;
                temp_Timer_End_Signal_sound_switch = 0;
                show_row_feedback(passobj);

            }
        }

    }

    function show_all_columns_in_one_row(proobj) {

        var data_row_list = proobj.fundata.data_row_list;
        var current_row = data_row_list[proobj.fundata.current_row_index];
        var data_column_list = current_row.data_column_list;

        //Note, if put here, one long sound will run 3 or more following simulate, see issue from ShenChaoRan
        //We will control this by userself, not by opes framework
        /*
	if(current_row.responseType==RESPONSE_TYPE_SOUND_SWITCH)
	{
		temp_Timer_End_Signal_sound_switch=1;//Turn on the sound switch. Notes: this is one global variable, which is only used for STIMULATE_TYPE_SOUND_SWITCH
	}else
	{
		temp_Timer_End_Signal_sound_switch=0;//Turn off the sound switch
	}
	*/

        for (var i = 0; i < data_column_list.length; i++) {
            var column = data_column_list[i];
            var passobj = {};
            passobj.proobj = proobj;
            passobj.current_row = current_row;
            passobj.column = column;
            var timeoutIDForDelayTime = null;
            var timeoutIDForAliveTime = null;
            if (column.stimulateType == STIMULATE_TYPE_PLAINTEXT) {
                timeoutIDForDelayTime = window.setTimeout(show_column_text, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_NULL) {
                timeoutIDForDelayTime = window.setTimeout(show_column_null, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_INPUT) {
                timeoutIDForDelayTime = window.setTimeout(show_column_input, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_DATE) {
                timeoutIDForDelayTime = window.setTimeout(show_column_date, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_BUTTON) {
                timeoutIDForDelayTime = window.setTimeout(show_column_button, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_IMAGE) {
                timeoutIDForDelayTime = window.setTimeout(show_column_image, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_BINDANDACCEPTSINGLEKEY) {
                timeoutIDForDelayTime = window.setTimeout(bind_keys_and_accept_single_key, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_SOUND_SWITCH) {
                timeoutIDForDelayTime = window.setTimeout(bind_sound_switch_recorder_and_accept_user_sound, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_TURNON_SOUND_SWITCH) {
                timeoutIDForDelayTime = window.setTimeout(show_column_turnon_sound_switch, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_TURNOFF_SOUND_SWITCH) {
                timeoutIDForDelayTime = window.setTimeout(show_column_turnoff_sound_switch, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_RADIOBUTTON) {
                timeoutIDForDelayTime = window.setTimeout(show_column_radiobutton, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_CHECKBOX) {
                timeoutIDForDelayTime = window.setTimeout(show_column_checkbox, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_TEXTAREA) {
                timeoutIDForDelayTime = window.setTimeout(show_column_textarea, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_POST_CUSTOM_CODE) {

            } else if (column.stimulateType == STIMULATE_TYPE_PRE_CUSTOM_CODE) {

            } else if (column.stimulateType == STIMULATE_TYPE_SOUND) {
                timeoutIDForDelayTime = window.setTimeout(show_column_sound, column.delayTime, passobj);

            } else if (column.stimulateType == STIMULATE_TYPE_MOUSE_TYPE) {
                timeoutIDForDelayTime = window.setTimeout(show_column_mousetype, column.delayTime, passobj);

            } else {
                alert('TODO: for ' + column.stimulateType);
            }
            column.timeoutIDForDelayTime = timeoutIDForDelayTime;
            column.timeoutIDForAliveTime = timeoutIDForAliveTime;
        }
    }

    function show_column_null(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }

        var timeoutIDForAliveTime = window.setTimeout(hide_column_null, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function execute_pre_custom_code_ifany(proobj) {
        var data_row_list = proobj.fundata.data_row_list;
        var current_row = data_row_list[proobj.fundata.current_row_index];
        var data_column_list = current_row.data_column_list;
        for (var i = 0; i < data_column_list.length; i++) {
            var column = data_column_list[i];
            if (column.stimulateType == STIMULATE_TYPE_PRE_CUSTOM_CODE) {
                var temp_func_name = function (args) {
                };
                temp_func_name = eval(column.funName);
                temp_func_name(proobj);

            }
        }
    }

    function execute_post_custom_code_ifany(proobj) {
        var data_row_list = proobj.fundata.data_row_list;
        var current_row = data_row_list[proobj.fundata.current_row_index];
        var data_column_list = current_row.data_column_list;
        for (var i = 0; i < data_column_list.length; i++) {
            var column = data_column_list[i];
            if (column.stimulateType == STIMULATE_TYPE_POST_CUSTOM_CODE) {
                var temp_func_name = function (args) {
                };
                temp_func_name = eval(column.funName);
                temp_func_name(proobj);

            }
        }
    }

    function show_column_turnon_sound_switch() {
        temp_Timer_End_Signal_sound_switch = 1;//Turn on the sound switch. Notes: this is one global variable, which is only used for STIMULATE_TYPE_SOUND_SWITCH
    }

    function show_column_turnoff_sound_switch() {
        temp_Timer_End_Signal_sound_switch = 0;//Turn off the sound switch. Notes: this is one global variable, which is only used for STIMULATE_TYPE_SOUND_SWITCH
    }

    function show_row_feedback(passobj) {
        save_previous_result(passobj.proobj);

        var proobj = passobj.proobj;
        var data_row_list = proobj.fundata.data_row_list;
        var current_row = data_row_list[proobj.fundata.current_row_index];
        if (current_row.rowTimeoutID != null) {
            clearTimeout(current_row.rowTimeoutID);//as goto next snapshot via user click, so clear the goto next snapshot timeOut
        }
        if (current_row.responseType == RESPONSE_TYPE_SINGLEKEY) {
            reset_all_user_defined_keys();
        }
        if (current_row.feedbackFlag == 1) {
            if (current_row.feedback.cleanupAllColumnsWhenShowFeedback) {
                $('#opes_cotainer_div').html('');
            }
            var feedbackContent = '<div style="width:99%;border:0px solid;text-align:center;" id="feedback_id">';
            feedbackContent += '	<div><span id="correct_result_span_id"></span><span id="user_result_span_id"></span></div>';
            feedbackContent += '	<div><span id="feedback_img_span_id"></span><span id="feedback_msg_span_id"></span></div>';
            feedbackContent += '</div>';

            $('#opes_cotainer_div').append(feedbackContent);
            if (current_row.feedback.showCorrectResult) {
                $('#correct_result_span_id').html('正确答案：' + current_row.correctResult + '&nbsp;&nbsp;&nbsp;');
            }
            if (current_row.feedback.showUserResult) {
                $('#user_result_span_id').html('你的答案：' + (typeof current_row.userResult == 'undefined' ? '' : current_row.userResult));
            }
            if (current_row.feedback.showMsg) {
                if (current_row.userResult == current_row.correctResult) {
                    $('#feedback_msg_span_id').html(current_row.feedback.msgImage.msgForCorrectResult);
                    if (current_row.feedback.showImage) {
                        var img = '<img id="feedback_img_id" src="../../../image/logoicon.png" />';
                        $('#feedback_img_span_id').html(img);
                        $('#feedback_img_id').css({
                            'width': current_row.feedback.msgImage.width,
                            'height': current_row.feedback.msgImage.height
                        });
                    }
                } else {
                    $('#feedback_msg_span_id').html(current_row.feedback.msgImage.msgForWrongResult);
                    if (current_row.feedback.showImage) {
                        var img = '<img id="feedback_img_id" src="../../../image/logoicon.png" />';
                        $('#feedback_img_span_id').html(img);
                        $('#feedback_img_id').css({
                            'width': current_row.feedback.msgImage.width,
                            'height': current_row.feedback.msgImage.height
                        });
                    }
                }
            }

            $('#feedback_id').css({
                'font-size': current_row.feedback.msgImage.fontsize + 'px',
                'color': '#' + current_row.feedback.msgImage.fontcolor,
                'position': 'absolute'
            });
            $('#feedback_id').position({
                my: current_row.feedback.msgImage.position.my,
                at: current_row.feedback.msgImage.position.at,
                collision: "none",
                of: $(document)
            });

            execute_post_custom_code_ifany(passobj.proobj);
            var timeoutIDForRowFeedbackAliveTime = window.setTimeout(show_next_snapshot, current_row.feedback.aliveTime, proobj);
            current_row.timeoutIDForRowFeedbackAliveTime = timeoutIDForRowFeedbackAliveTime;
        } else {
            execute_post_custom_code_ifany(passobj.proobj);
            show_next_snapshot(proobj);
        }

    }

    function show_column_text(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }
        var column_span_id = 'column_id_' + column.id;
        $('#opes_cotainer_div').append('<div id="' + column_span_id + '"></div>');
        $('#' + column_span_id).html(column.text);
        $('#' + column_span_id).css({
            'font-size': column.fontsize + 'px',
            'font-family': '\'' + column.fontfamily + '\',sans-serif',
            'color': '#' + column.fontcolor,
            'position': 'absolute',
            'text-align': 'center'
        });
        $('#' + column_span_id).css({'width': column.textDivWidth, 'height': column.textDivHeight});
        $('#' + column_span_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        //$('#'+column_span_id).css({'width':column.textDivWidth,'height':column.textDivHeight,'position':'absolute'});

        var timeoutIDForAliveTime = window.setTimeout(hide_column_text, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function show_column_mousetype(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }

        if (column.mousetype == 'custom_mouse_type') {
            $('body').css({'cursor': 'url(' + column.mouse_type_image + '), auto'});
        } else {
            $('body').css({'cursor': column.mousetype});
        }

        var timeoutIDForAliveTime = window.setTimeout(hide_column_mousetype, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function bind_keys_and_accept_single_key(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }
        var userDefinedKeys = column.userDefinedKeys;
        Mousetrap.bind(userDefinedKeys, function (e) {
            process_user_response_single_key(proobj, String.fromCharCode(e.keyCode || e.which));
        });

        var timeoutIDForAliveTime = window.setTimeout(reset_all_user_defined_keys, column.aliveTime);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function bind_sound_switch_recorder_and_accept_user_sound(passobj) {
        temp_proobj_for_sound_switch = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }
        //TODO
        $('body').append('<div id="flashContainer"></div>');
        //swfobject.registerObject("flashContainer", "6.0.0", "../../../../OPES2/js/soundRecordSwitch/expressInstall.swf");
        swfobject.registerObject("flashContainer", "6.0.0", "/lattice/OPES2/js/soundRecordSwitch/expressInstall.swf");

        //20 40 is good..
        //var microLevel=20;//声音阀值
        var microLevel = 10;//声音阀值
        var scilenceTime = 1;//声音停止后时间
        var functionName = "process_user_response_sound_switch";//函数名，可以自己重新定义函数，将自己定义的函数名放在这里
        //var gain=40;//麦克风增益
        var gain = 80;//麦克风增益
        var soundRate = 22;//声音频率,单位khz
        //出现声音的时候调度，before，声音结束的时候调度，after
        var before = 0;
        var after = 1;
        var dispatchWay = before;
        //下面的代码一般无需修改，修改参数的话可以改上面
        var params =
            {
                wmode: "transparent"
            };
        //swfobject.embedSWF("../../../../OPES2/js/soundRecordSwitch/WebCamMicStatus.swf", "flashContainer", "220", "140", "6.0.0", "../../../../OPES2/js/soundRecordSwitch/expressInstall.swf", {microLevel:microLevel,scilenceTime:scilenceTime,functionName:functionName,gain:gain,soundRate:soundRate,dispatchWay:dispatchWay},params);
        swfobject.embedSWF("/lattice/OPES2/js/soundRecordSwitch/WebCamMicStatus.swf", "flashContainer", "220", "140", "6.0.0", "/lattice/OPES2/js/soundRecordSwitch/expressInstall.swf", {
            microLevel: microLevel,
            scilenceTime: scilenceTime,
            functionName: functionName,
            gain: gain,
            soundRate: soundRate,
            dispatchWay: dispatchWay
        }, params);

        //alert('bind_sound_switch_recorder_and_accept_user_sound')
    }

    function hide_column_null(column) {

    }

    function hide_column_text(column) {
        $('#column_id_' + column.id).remove();
    }

    function hide_column_radiobutton(column) {
        $('#column_id_' + column.id).remove();
    }

    function hide_column_checkbox(column) {
        $('#column_id_' + column.id).remove();
    }

    function hide_column_textarea(column) {
        $('#USER_RESULT_ID').remove();
    }

    function hide_column_mousetype(column) {
        $('body').css({'cursor': 'auto'});
    }

    function hide_column_sound(column) {
        //column.column_sound_player_id=column_sound_player_id;
        //column.column_sound_container_id=column_sound_container_id;
        $('#' + column.column_sound_player_id).jPlayer('stop');
        $('#column_div_id_' + column.id).remove();
    }

    function show_column_checkbox(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }
        var radiobtn = '<span id="column_id_' + column.id + '">';
        for (var i = 0; i < column.options.length; i++) {
            var opt = column.options[i];
            radiobtn += '<input type="checkbox" name="USER_RESULT_ID" value="' + opt.name + '"></input>' + opt.value + '&nbsp;&nbsp;';
        }
        radiobtn += '</span>';
        $('#opes_cotainer_div').append(radiobtn);
        $('#column_id_' + column.id).css({
            'font-size': column.fontsize + 'px',
            'color': '#' + column.fontcolor,
            'position': 'absolute',
            'z-index': 99999
        });

        $('#column_id_' + column.id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        var timeoutIDForAliveTime = window.setTimeout(hide_column_checkbox, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function show_column_radiobutton(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }

        var radiobtn = '<span id="column_id_' + column.id + '">';
        for (var i = 0; i < column.options.length; i++) {
            var opt = column.options[i];
            radiobtn += '<input type="radio" id="column_radiobutton_option_id_' + column.id + '_' + i + '" name="USER_RESULT_ID" value="' + opt.value + '" style="zoom:190%;" ></input>' + opt.name + '&nbsp;&nbsp;';
        }
        radiobtn += '</span>';
        $('#opes_cotainer_div').append(radiobtn);
        column_radiobutton_onclick(passobj);
        $('#column_id_' + column.id).css({
            'font-size': column.fontsize + 'px',
            'color': '#' + column.fontcolor,
            'position': 'absolute',
            'z-index': 99999
        });

        $('#column_id_' + column.id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        var timeoutIDForAliveTime = window.setTimeout(hide_column_radiobutton, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function column_radiobutton_onclick(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;

        for (var i = 0; i < column.options.length; i++) {
            var opt = column.options[i];
            var column_option_id = "column_radiobutton_option_id_" + column.id + "_" + i;
            $('#' + column_option_id).bind({
                click: function () {
                    if (column.gotoNextOnClick) {
                        if (current_row.rowTimeoutID != null) {
                            clearTimeout(current_row.rowTimeoutID);//as goto next snapshot via user click, so clear the goto next snapshot timeOut
                        }
                        show_row_feedback(passobj);
                    }
                }
            });
        }
    }

    function show_column_date(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }

        $('#opes_cotainer_div').append('<span id="column_date_span_id"><input id="USER_RESULT_ID" value="" /><img src="/lattice/OPES2/imgs/date.png"></img></span>');
        $("#USER_RESULT_ID").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'yy-mm-dd',
            yearRange: "1980:2016"

        });
        $('#column_date_span_id').css({'position': 'absolute'});

        $('#column_date_span_id').position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        var timeoutIDForAliveTime = window.setTimeout(hide_column_text, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function show_column_input(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }

        $('#opes_cotainer_div').append('<input id="USER_RESULT_ID" value="" />');
        $('#USER_RESULT_ID').css({'position': 'absolute'});
        show_column_input_addTextChangeEvent('USER_RESULT_ID', column);

        $('#USER_RESULT_ID').position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        var timeoutIDForAliveTime = window.setTimeout(hide_column_text, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;

        $('#USER_RESULT_ID').focus();

    }

    function show_column_input_addTextChangeEvent(input_id, column) {
        $("#" + input_id).keyup(function () {
            var value = $("#" + input_id).val();
            if (column.inputType == 'INPUT_TYPE_NUMBER') {
                $("#" + input_id).val(value.replace(/[^\d]/g, ''));

            } else if (column.inputType == 'INPUT_TYPE_TEXT') {

            } else if (column.inputType == 'INPUT_TYPE_COMMENTS') {

            } else {
                alert('Invalid column.inputType ' + column.inputType);
            }
        });
    }

    function show_column_button(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }
        var column_span_id = 'column_id_' + column.id;
        $('#opes_cotainer_div').append('<input type=button id="' + column_span_id + '" value="' + column.text + '" />');
        $('#' + column_span_id).css({'font-size': column.fontsize + 'px', 'position': 'absolute', 'z-index': 99999});
        $('#' + column_span_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        $('#' + column_span_id).bind({
            click: function () {
                if (current_row.rowTimeoutID != null) {
                    clearTimeout(current_row.rowTimeoutID);//as goto next snapshot via user click, so clear the goto next snapshot timeOut
                }
                show_row_feedback(passobj);
            }
        });
        var timeoutIDForAliveTime = window.setTimeout(hide_column_text, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function show_column_textarea(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }
        $('#opes_cotainer_div').append('<textarea id="USER_RESULT_ID" value="" ></textarea>');
        $('#USER_RESULT_ID').css({
            'width': column.width + 'px',
            'height': column.height + 'px',
            'position': 'absolute'
        });
        $('#USER_RESULT_ID').position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        var timeoutIDForAliveTime = window.setTimeout(hide_column_textarea, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function show_column_image(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }
        var column_span_id = 'column_id_' + column.id;
        var onclickFunc = 'onclick=javascript:;';
        if (column.enableOnclickEvent) {
            __TEMP_GLOBAL_VARIABLE_FOR_IMAGE_ON_CLICK_passobj = passobj;
            if (column.useGlobalDefinedFunctionForOnclick) {
                alert('TODO for useGlobalDefinedFunctionForOnclick');
            } else {
                onclickFunc = 'onclick=' + column.onclickFunName + '(this)';
            }

        }
        $('#opes_cotainer_div').append('<img id="' + column_span_id + '" ' + onclickFunc + ' src="' + column.src + '" />');
        $('#' + column_span_id).css({'width': column.width, 'height': column.height, 'position': 'absolute'});
        $('#' + column_span_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        var timeoutIDForAliveTime = window.setTimeout(hide_column_text, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
    }

    function show_column_sound(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        if (column.startRecordResponseStartTime) {
            current_row.responseStartTime = getTimestamp();
        }
        var column_sound_player_id = 'column_sound_player_id_' + column.id;
        var column_sound_container_id = 'column_sound_container_id_' + column.id;
        column.column_sound_player_id = column_sound_player_id;
        column.column_sound_container_id = column_sound_container_id;
        $('#opes_cotainer_div').append(show_column_sound_genPlayerContent(column));

        $('#' + column_sound_container_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        $('#' + column_sound_player_id).css({'position': 'absolute'});
        $('#' + column_sound_container_id).css({'position': 'absolute'});

        /*
	$('#opes_cotainer_div').append('<img id="testaaa" src="/lattice/images/home/project.png"></img>');
	$('#testaaa').position({
		my: column.position.my,
		at: column.position.at,
		collision: "none",
		of: $(document)
	});*/

        if (column.autoStart) {

            $("#" + column_sound_player_id).jPlayer({
                ready: function (event) {
                    $(this).jPlayer("setMedia", {
                        title: column.title,
                        mp3: column.src
                    }).jPlayer("play"); // Attempt to auto play the media;
                },
                ended: function () { // The $.jPlayer.event.ended event
                    // $(this).jPlayer("play"); // Repeat the media
                },
                cssSelectorAncestor: "#" + column_sound_container_id,
                swfPath: "/lattice/OPES2/js/jplayer/jplayer",
                supplied: "m4a, oga,mp3",
                wmode: "window",
                useStateClassSkin: true,
                autoBlur: false,
                smoothPlayBar: true,
                keyEnabled: false,
                remainingDuration: true,
                toggleDuration: true
            });
        } else {
            $("#" + column_sound_player_id).jPlayer({
                ready: function (event) {
                    $(this).jPlayer("setMedia", {
                        title: column.title,
                        mp3: column.src
                    }); // Attempt to auto play the media;
                },
                ended: function () { // The $.jPlayer.event.ended event
                    // $(this).jPlayer("play"); // Repeat the media
                },
                cssSelectorAncestor: "#" + column_sound_container_id,
                swfPath: "/lattice/OPES2/js/jplayer/jplayer",
                supplied: "m4a, oga,mp3",
                wmode: "window",
                useStateClassSkin: true,
                autoBlur: false,
                smoothPlayBar: true,
                keyEnabled: true,
                remainingDuration: true,
                toggleDuration: true
            });
        }
        if (column.hide) {
            $('#column_div_id_' + column.id).css({'display': 'none'});
        }

        var timeoutIDForAliveTime = window.setTimeout(hide_column_sound, column.aliveTime, column);
        column.timeoutIDForAliveTime = timeoutIDForAliveTime;
        //alert(column.aliveTime+'    timeoutIDForAliveTime'+timeoutIDForAliveTime);
    }

    //The content please refer to 02.html under /lattice/test/jplayer/02.html
    function show_column_sound_genPlayerContent(column) {
        //alert('show_column_sound_genPlayerContent='+column.column_sound_player_id);
        var column_sound_player_id = column.column_sound_player_id;
        var column_sound_container_id = column.column_sound_container_id;
        var column_div_id = 'column_div_id_' + column.id;
        var content = '';
        content += '<div id="' + column_div_id + '" >';
        content += '<div id="' + column_sound_player_id + '" class="jp-jplayer" ></div>';
        content += '<div id="' + column_sound_container_id + '" class="jp-audio" role="application" aria-label="media player" >';
        content += '	<div class="jp-type-single">';
        content += '		<div class="jp-gui jp-interface">';
        content += '			<div class="jp-controls">';
        content += '				<button class="jp-play" role="button" tabindex="0">play</button>';
        content += '				<button class="jp-stop" role="button" tabindex="0">stop</button>';
        content += '			</div>';
        content += '			<div class="jp-progress">';
        content += '				<div class="jp-seek-bar">';
        content += '					<div class="jp-play-bar"></div>';
        content += '				</div>';
        content += '			</div>';
        content += '			<div class="jp-volume-controls">';
        content += '				<button class="jp-mute" role="button" tabindex="0">mute</button>';
        content += '				<button class="jp-volume-max" role="button" tabindex="0">max volume</button>';
        content += '				<div class="jp-volume-bar">';
        content += '					<div class="jp-volume-bar-value"></div>';
        content += '				</div>';
        content += '			</div>';
        content += '			<div class="jp-time-holder">';
        content += '				<div class="jp-current-time" role="timer" aria-label="time">&nbsp;</div>';
        content += '			<div class="jp-duration" role="timer" aria-label="duration">&nbsp;</div>';
        content += '				<div class="jp-toggles">';
        content += '					<button class="jp-repeat" role="button" tabindex="0">repeat</button>';
        content += '				</div>';
        content += '			</div>';
        content += '		</div>';
        content += '		<div class="jp-details">';
        content += '			<div class="jp-title" aria-label="title">&nbsp;</div>';
        content += '		</div>';
        content += '	</div>';
        content += '</div>';
        content += '</div>';//end of column div
        return content;
    }


    function save_previous_result(proobj) {
        //alert('save_previous_result');
        var data_row_list = proobj.fundata.data_row_list;
        var current_row = data_row_list[proobj.fundata.current_row_index];
        current_row.userResult = null;
        if (current_row.responseFlag == 1) {
            //alert('current_row.responseFlag='+current_row.responseFlag+'   current_row.responseType='+current_row.responseType);
            if (current_row.responseEndTime == null)//the responseEndTime can be already set, e.g. when the user type the key
            {
                current_row.responseEndTime = getTimestamp();
            }
            current_row.responseDuration = current_row.responseEndTime - current_row.responseStartTime;
            //alert(current_row.responseDuration);
            current_row.eventOnset = current_row.responseStartTime;
            var first_row = data_row_list[0];
            var first_row_onset = first_row.eventOnset

            if (proobj.fundata.current_row_index > 0) {
                current_row.eventOnset = current_row.responseStartTime - first_row_onset;
            }

            if (current_row.responseType == RESPONSE_TYPE_SINGLEKEY || current_row.responseType == RESPONSE_TYPE_INPUT || current_row.responseType == RESPONSE_TYPE_DATE || current_row.responseType == RESPONSE_TYPE_TEXTAREA || current_row.responseType == RESPONSE_TYPE_RICHTEXT) {
                var result = $('#USER_RESULT_ID').val();
                current_row.userResult = result;
                //current_row.userResult=memo_Temp;
                $('#USER_RESULT_ID').val('');

            } else if (current_row.responseType == RESPONSE_TYPE_RADIOBUTTON) {
                var result = $("input[name='USER_RESULT_ID'][type='radio']:checked").val();
                current_row.userResult = result;
            } else if (current_row.responseType == RESPONSE_TYPE_CHECKBOX) {
                var result = '';
                $("input[name='USER_RESULT_ID'][type='checkbox']:checked").each(function () {
                    result = result + $(this).val();
                });
                current_row.userResult = result;
            } else if (current_row.responseType == RESPONSE_TYPE_SOUND_SWITCH) {
                current_row.userResult = '0';
                //alert('save_previous_result');
            } else {
                alert('TODO: for ' + current_row.responseType);
            }
        }
        //$('#opes_cotainer_div').html('');
    }


    /***********************************[data_surveyform.js]***********************************/



    function data_surveyform_js_showSurveyForm_(fundata, callbackargs) {
        $('#opes_cotainer_div').html('');
        var proobj = {};
        proobj.fundata = fundata;
        proobj.callbackargs = callbackargs;
        data_surveyform_js_showSurveyForm_showAllRowsInOnePage_(proobj);
    }

    function data_surveyform_js_showSurveyForm_showAllRowsInOnePage_(proobj) {
        var data_row_list = proobj.fundata.data_row_list;
        for (var r = 0; r < data_row_list.length; r++) {
            var current_row = data_row_list[r];
            var data_column_list = current_row.data_column_list;
            for (var i = 0; i < data_column_list.length; i++) {
                var column = data_column_list[i];
                var passobj = {};
                passobj.proobj = proobj;
                passobj.current_row = current_row;
                passobj.column = column;
                if (column.stimulateType == STIMULATE_TYPE_PLAINTEXT) {
                    data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_text_(passobj);

                } else if (column.stimulateType == STIMULATE_TYPE_NULL) {
                    alert('TODO: for ' + column.stimulateType + '  of data_surveyform_js.');
                } else if (column.stimulateType == STIMULATE_TYPE_INPUT) {
                    data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_input_(passobj);

                } else if (column.stimulateType == STIMULATE_TYPE_BUTTON) {
                    data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_button_(passobj);

                } else if (column.stimulateType == STIMULATE_TYPE_IMAGE) {
                    data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_image_(passobj);

                } else if (column.stimulateType == STIMULATE_TYPE_BINDANDACCEPTSINGLEKEY) {
                    alert('TODO: for ' + column.stimulateType + '  of data_surveyform_js.');
                } else if (column.stimulateType == STIMULATE_TYPE_RADIOBUTTON) {
                    data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_radiobutton_(passobj);

                } else if (column.stimulateType == STIMULATE_TYPE_CHECKBOX) {
                    data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_checkbox_(passobj);

                } else if (column.stimulateType == STIMULATE_TYPE_TEXTAREA) {
                    data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_textarea_(passobj);

                } else if (column.stimulateType == STIMULATE_TYPE_POST_CUSTOM_CODE) {
                    alert('TODO: for ' + column.stimulateType + '  of data_surveyform_js.');
                } else if (column.stimulateType == STIMULATE_TYPE_PRE_CUSTOM_CODE) {
                    alert('TODO: for ' + column.stimulateType + '  of data_surveyform_js.');
                } else if (column.stimulateType == STIMULATE_TYPE_SOUND) {
                    alert('TODO: for ' + column.stimulateType + '  of data_surveyform_js.');
                } else if (column.stimulateType == STIMULATE_TYPE_MOUSE_TYPE) {
                    alert('TODO: for ' + column.stimulateType + '  of data_surveyform_js.');
                } else {
                    alert('TODO: for ' + column.stimulateType + '  of data_surveyform_js.');
                }
            }//end column list loop

        }//end row list loop
    }

    function data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_input_(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;

        var user_result_id = 'USER_RESULT_ID_' + current_row.id + '_' + column.id;
        $('#opes_cotainer_div').append('<input id="' + user_result_id + '" value="" />');
        $('#' + user_result_id).css({'position': 'absolute'});
        $('#' + user_result_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
    }

    function data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_text_(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        var column_span_id = 'USER_RESULT_ID_' + current_row.id + '_' + column.id;
        $('#opes_cotainer_div').append('<span id="' + column_span_id + '"></span>');
        $('#' + column_span_id).html(column.text);
        $('#' + column_span_id).css({
            'font-size': column.fontsize + 'px',
            'color': '#' + column.fontcolor,
            'position': 'absolute'
        });
        $('#' + column_span_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
    }

    function data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_textarea_(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        var user_result_id = 'USER_RESULT_ID_' + current_row.id + '_' + column.id;

        $('#opes_cotainer_div').append('<textarea id="' + user_result_id + '" value="" ></textarea>');
        $('#' + user_result_id).css({
            'width': column.width + 'px',
            'height': column.height + 'px',
            'position': 'absolute'
        });
        $('#' + user_result_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
    }

    function data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_image_(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        var column_span_id = 'USER_RESULT_ID_' + current_row.id + '_' + column.id;
        $('#opes_cotainer_div').append('<img id="' + column_span_id + '" src="' + column.src + '" />');
        $('#' + column_span_id).css({'width': column.width, 'height': column.height, 'position': 'absolute'});
        $('#' + column_span_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
    }

    function data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_checkbox_(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;

        var column_span_id = 'COLUMN_SPAN_ID_' + current_row.id + '_' + column.id;
        var user_result_id = 'USER_RESULT_ID_' + current_row.id + '_' + column.id;

        var radiobtn = '<span id="' + column_span_id + '">';
        for (var i = 0; i < column.options.length; i++) {
            var opt = column.options[i];
            radiobtn += '<input type="checkbox" name="' + user_result_id + '" value="' + opt.name + '"></input>' + opt.value + '&nbsp;&nbsp;';
        }
        radiobtn += '</span>';
        $('#opes_cotainer_div').append(radiobtn);
        $('#' + column_span_id).css({
            'font-size': column.fontsize + 'px',
            'color': '#' + column.fontcolor,
            'position': 'absolute'
        });
        $('#' + column_span_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
    }

    function data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_radiobutton_(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;

        var column_span_id = 'COLUMN_SPAN_ID_' + current_row.id + '_' + column.id;
        var user_result_id = 'USER_RESULT_ID_' + current_row.id + '_' + column.id;

        var radiobtn = '<span id="' + column_span_id + '">';
        for (var i = 0; i < column.options.length; i++) {
            var opt = column.options[i];
            radiobtn += '<input type="radio" name="' + user_result_id + '" value="' + opt.name + '"  ></input>' + opt.value + '&nbsp;&nbsp;';
        }
        radiobtn += '</span>';
        $('#opes_cotainer_div').append(radiobtn);
        column_radiobutton_onclick(passobj);
        $('#' + column_span_id).css({
            'font-size': column.fontsize + 'px',
            'color': '#' + column.fontcolor,
            'position': 'absolute'
        });
        $('#' + column_span_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
    }

    function data_surveyform_js_showSurveyForm_showAllRowsInOnePage_show_column_button_(passobj) {
        var proobj = passobj.proobj;
        var current_row = passobj.current_row;
        var column = passobj.column;
        var column_span_id = 'COLUMN_SPAN_ID_' + current_row.id + '_' + column.id;
        $('#opes_cotainer_div').append('<input type=button id="' + column_span_id + '" value="' + column.text + '" />');
        $('#' + column_span_id).css({'font-size': column.fontsize + 'px', 'position': 'absolute'});
        $('#' + column_span_id).position({
            my: column.position.my,
            at: column.position.at,
            collision: "none",
            of: $(document)
        });
        $('#' + column_span_id).bind({
            click: function () {
                data_surveyform_js_showSurveyForm_collect_result_(passobj);
            }
        });
    }

    //One problem here is: if there are 2 inputs in 1 row, it will only save the last one as the userResult for this row.
    function data_surveyform_js_showSurveyForm_collect_result_(passobj) {
        var proobj = passobj.proobj;
        var data_row_list = proobj.fundata.data_row_list;
        for (var r = 0; r < data_row_list.length; r++) {
            var current_row = data_row_list[r];
            var data_column_list = current_row.data_column_list;
            for (var i = 0; i < data_column_list.length; i++) {
                var column = data_column_list[i];
                var passobj = {};
                passobj.proobj = proobj;
                passobj.current_row = current_row;
                passobj.column = column;
                var user_result_id = 'USER_RESULT_ID_' + current_row.id + '_' + column.id;
                if (column.stimulateType == STIMULATE_TYPE_INPUT || column.stimulateType == STIMULATE_TYPE_TEXTAREA) {
                    var result = $('#' + user_result_id).val();
                    current_row.userResult = result;
                    if (current_row.userResult == undefined || current_row.userResult == 'undefined' || current_row.userResult == '') {
                        alert('请认真填写所有结果！');
                        return;
                    }

                } else if (column.stimulateType == STIMULATE_TYPE_RADIOBUTTON) {
                    var result = $("input[name='" + user_result_id + "'][type='radio']:checked").val();
                    current_row.userResult = result;
                    if (current_row.userResult == undefined || current_row.userResult == 'undefined' || current_row.userResult == '') {
                        alert('请认真填写所有结果！');
                        return;
                    }

                } else if (column.stimulateType == STIMULATE_TYPE_CHECKBOX) {
                    var result = '';
                    $("input[name='" + user_result_id + "'][type='checkbox']:checked").each(function () {
                        result = result + $(this).val();
                    });
                    current_row.userResult = result;
                    if (current_row.userResult == undefined || current_row.userResult == 'undefined' || current_row.userResult == '') {
                        alert('请认真填写所有结果！');
                        return;
                    }

                }
            }
        }

        //$('#opes_cotainer_div').html(JSON.stringify(passobj));
        //return;
        var callback = proobj.callbackargs.callback;
        exec_func_util(callback.func_name, callback.params, callback);

    }


    /***********************************[text.js]***********************************/


    /***********************************[wait.js]***********************************/



    function show_progress_bar(proobj) {
        var starttime = new Date();
        var int_starttime = starttime.getTime();
        var progressbarid = 'progress_bar_' + int_starttime;
        var progresslabelid = 'progress_label_' + int_starttime;
        var progress_sleepmsgid = 'progress_sleepmsgid' + int_starttime;
        $("#" + progressbarid).remove();

        var progress_div = '<div id="' + progressbarid + '"><div id="' + progresslabelid + '">Loading...</div></div>';
        $("body").append(progress_div);
        //$('body').css({'background-color':'#000'});
        //$('body').css({'color':'#FFF'});

        $("#" + progressbarid).css({
            'width': '600px',
            'height': '30px'
        });
        $("#" + progresslabelid).css({
            'position': 'absolute',
            'left': '50%',
            'top': '6px',
            'font-weight': 'bold',
            'font-size': '20px',
            'text-shadow': '1px 1px 0 #fff'
        });
        $('#' + progressbarid).position({
            my: 'center center',
            at: 'center center',
            collision: "none",
            of: $(document)
        });

        $("#" + progressbarid).progressbar({
            value: 0
        });
        //for all the definitions, pls check toolbox_wait.js
        var duration = proobj.fundata.sleeptime;//in ms
        var msgflag = proobj.fundata.msgflag;
        var msgcontent = proobj.fundata.msgcontent;
        proobj.fundata.progress_sleepmsgid = progress_sleepmsgid;
        var timeout_id = null;
        var bar_obj = {};
        bar_obj.int_starttime = int_starttime;
        bar_obj.duration = duration;
        bar_obj.progressbarid = progressbarid;
        bar_obj.progresslabelid = progresslabelid;
        bar_obj.progress_sleepmsgid = progress_sleepmsgid;
        bar_obj.timeout_id = timeout_id;
        bar_obj.proobj = proobj;
        update_progress_bar(bar_obj);

        progress_bar_show_sleep_message(proobj);
    }

    function update_progress_bar(bar_obj) {
        var starttime = bar_obj.int_starttime;
        var duration = bar_obj.duration;
        var progressbarid = bar_obj.progressbarid;
        var progresslabelid = bar_obj.progresslabelid;
        var progress_sleepmsgid = bar_obj.progress_sleepmsgid;
        var timeout_id = bar_obj.timeout_id;
        var proobj = bar_obj.proobj;

        var now = new Date();
        var time = now.getTime();
        var elapset = (time - starttime);
        if (elapset < duration) {
            var showv = parseInt(elapset * 100 / duration);
            $("#" + progressbarid).progressbar("option", "value", showv);
            $("#" + progresslabelid).text($("#" + progressbarid).progressbar("value") + "%");
            if (timeout_id != null) {
                clearTimeout(timeout_id);
            }
            var update_interval = 60;

            timeout_id = window.setTimeout(update_progress_bar, update_interval, bar_obj);
            //timeout_id= window.setTimeout("update_progress_bar("+starttime+","+duration+",\""+progressbarid+"\",\""+progresslabelid+"\","+timeout_id+")",update_interval);

        } else {
            $("#" + progressbarid).progressbar("option", "value", 100);
            $("#" + progresslabelid).text("100%");
            $("#" + progressbarid).remove();
            $("#" + progress_sleepmsgid).remove();
            //clearTimeout(progress_bar_vars.progress_bar_timeout_id);
            //alert('done');

            //call next stage
            var callback = proobj.callbackargs.callback;
            exec_func_util(callback.func_name, callback.params, callback);
        }
    }

    function progress_bar_show_sleep_message(proobj) {
        var progress_sleepmsgid = proobj.fundata.progress_sleepmsgid;
        var msgflag = proobj.fundata.msgflag;
        var msgcontent = proobj.fundata.msgcontent;

        $("#" + progress_sleepmsgid).remove();

        var progress_sleepmsg_div = '<div id="' + progress_sleepmsgid + '">' + msgcontent + '</div>';
        $("body").append(progress_sleepmsg_div);

        $("#" + progress_sleepmsgid).css({
            'width': '600px',
            'height': '30px',
            'font-weight': 'bold',
            'font-size': '20px',
            'text-align': 'center'
        });

        $('#' + progress_sleepmsgid).position({
            my: 'center center',
            at: 'center center-50',
            collision: "none",
            of: $(document)
        });
    }


    /***********************************[timer.js]***********************************/



    function timer_js_show_progress_bar(proobj) {
        var starttime = new Date();
        var int_starttime = starttime.getTime();
        var progressbarid = 'timer_js_progress_bar_' + int_starttime;
        var progresslabelid = 'timer_js_progress_label_' + int_starttime;
        $("#" + progressbarid).remove();

        var progress_div = '<div id="' + progressbarid + '"><div id="' + progresslabelid + '">Loading...</div></div>';
        $("body").append(progress_div);
        //$('body').css({'background-color':'#000'});
        //$('body').css({'color':'#FFF'});

        $("#" + progressbarid).css({
            'width': '600px',
            'height': '30px'
        });
        $("#" + progresslabelid).css({
            'position': 'absolute',
            'left': '50%',
            'top': '6px',
            'font-weight': 'bold',
            'font-size': '20px',
            'text-shadow': '1px 1px 0 #fff'
        });
        $('#' + progressbarid).position({
            my: 'center top',
            at: 'center top',
            collision: "none",
            of: $(document)
        });

        $("#" + progressbarid).progressbar({
            value: 0
        });
        //for all the definitions, pls check toolbox_timer.js
        var duration = proobj.fundata.timelimit;//in ms
        var timeout_id = null;
        var bar_obj = {};
        bar_obj.int_starttime = int_starttime;
        bar_obj.duration = duration;
        bar_obj.progressbarid = progressbarid;
        bar_obj.progresslabelid = progresslabelid;
        bar_obj.timeout_id = timeout_id;
        bar_obj.proobj = proobj;
        timer_js_update_progress_bar(bar_obj);

        //call next stage
        var callback = proobj.callbackargs.callback;
        exec_func_util(callback.func_name, callback.params, callback);

    }

    function timer_js_update_progress_bar(bar_obj) {
        var starttime = bar_obj.int_starttime;
        var duration = bar_obj.duration;
        var progressbarid = bar_obj.progressbarid;
        var progresslabelid = bar_obj.progresslabelid;
        var timeout_id = bar_obj.timeout_id;
        var proobj = bar_obj.proobj;

        var now = new Date();
        var time = now.getTime();
        var elapset = (time - starttime);
        if (elapset < duration) {
            var showv = parseInt(elapset * 100 / duration);
            $("#" + progressbarid).progressbar("option", "value", showv);
            $("#" + progresslabelid).text($("#" + progressbarid).progressbar("value") + "%");
            if (timeout_id != null) {
                clearTimeout(timeout_id);
            }
            var update_interval = 300;
            timeout_id = window.setTimeout(timer_js_update_progress_bar, update_interval, bar_obj);
            //timeout_id= window.setTimeout("update_progress_bar("+starttime+","+duration+",\""+progressbarid+"\",\""+progresslabelid+"\","+timeout_id+")",update_interval);

        } else {
            $("#" + progressbarid).progressbar("option", "value", 100);
            $("#" + progresslabelid).text("100%");
            $("#" + progressbarid).remove();
            //clearTimeout(progress_bar_vars.progress_bar_timeout_id);
            //alert('done');

            //call next stage
            //var callback=proobj.callbackargs.callback;
            //exec_func_util(callback.func_name,callback.params,callback);
            post_result();
        }
    }


    /***********************************[code.js]***********************************/



    function code_(fundata, callbackargs) {
        var temp_func_name = function (args) {
        };
        temp_func_name = eval(fundata.funName);
        temp_func_name();

        //call next stage
        var callback = callbackargs.callback;
        exec_func_util(callback.func_name, callback.params, callback);
    }


    function _OPES_T11_IMG_ONCLICK_7_1_(proobj) {
//add your code here.....
        alert(proobj.id + '_____' + proobj.src);
        alert(JSON.stringify(__TEMP_GLOBAL_VARIABLE_FOR_IMAGE_ON_CLICK_passobj));
    }

    function _CUSTOM_OPES_T5_1492659693780_(proobj) {
//add your code here.....
//Here you can access all the variables:
//e.g. OPES_T2.func_name OPES_T3.params.code ...


        countError = 0;    //limited to 5 errors.

        timeLength = 60000;   //in milliseconds  1x60x1000=60000ms . limited to 1 mins.

        startTime = new Date();    //定义全局变量starttime，记录开始时间

        starttime = 0;
        maximumCountError = 5;

    }

    function _OPES_T3_PRE_1_4_(proobj) {
//add your code here.....

        var now = new Date();//定义局部变量，获取当前时间

        if (now - startTime >= timeLength) { //如果当前时间减去开始时间大于180000ms（即3分钟）
            //OPES_T3.params.current_row_index=lastIndex;
            post_result();
        }


    }

    function _OPES_T3_POST_1_5_(proobj) {
//add your code here.....

        var data_row_list = OPES_T3.params.data_row_list;//获取当前刺激序列

        var current_row = data_row_list[OPES_T3.params.current_row_index];//获取当前刺激

        if (current_row.userResult != current_row.correctResult) {//判断用户答案
            countError++; //错的话，全局变量countError加1
        }

        if (countError == maximumCountError) {
            post_result();
        }
    }

    function _OPES_T3_PRE_2_5_(proobj) {
//add your code here.....

        var now = new Date();//定义局部变量，获取当前时间

        if (now - startTime >= timeLength) { //如果当前时间减去开始时间大于180000ms（即3分钟）
            //OPES_T3.params.current_row_index=lastIndex;
            post_result();
        }


    }

    function _OPES_T3_POST_2_6_(proobj) {
//add your code here.....

        var data_row_list = OPES_T3.params.data_row_list;//获取当前刺激序列

        var current_row = data_row_list[OPES_T3.params.current_row_index];//获取当前刺激

        if (current_row.userResult != current_row.correctResult) {//判断用户答案
            countError++; //错的话，全局变量countError加1
        }

        if (countError == maximumCountError) {
            post_result();
        }
    }

    function _OPES_T3_PRE_3_6_(proobj) {
//add your code here.....

        var now = new Date();//定义局部变量，获取当前时间

        if (now - startTime >= timeLength) { //如果当前时间减去开始时间大于180000ms（即3分钟）
            //OPES_T3.params.current_row_index=lastIndex;
            post_result();
        }


    }

    function _OPES_T3_POST_3_7_(proobj) {
//add your code here.....

        var data_row_list = OPES_T3.params.data_row_list;//获取当前刺激序列

        var current_row = data_row_list[OPES_T3.params.current_row_index];//获取当前刺激

        if (current_row.userResult != current_row.correctResult) {//判断用户答案
            countError++; //错的话，全局变量countError加1
        }

        if (countError == maximumCountError) {
            post_result();
        }
    }

    function _OPES_T3_PRE_4_7_(proobj) {
//add your code here.....

        var now = new Date();//定义局部变量，获取当前时间

        if (now - startTime >= timeLength) { //如果当前时间减去开始时间大于180000ms（即3分钟）
            //OPES_T3.params.current_row_index=lastIndex;
            post_result();
        }


    }

    function _OPES_T3_POST_4_8_(proobj) {
//add your code here.....

        var data_row_list = OPES_T3.params.data_row_list;//获取当前刺激序列

        var current_row = data_row_list[OPES_T3.params.current_row_index];//获取当前刺激

        if (current_row.userResult != current_row.correctResult) {//判断用户答案
            countError++; //错的话，全局变量countError加1
        }

        if (countError == maximumCountError) {
            post_result();
        }
    }

    function _OPES_T3_PRE_5_8_(proobj) {
//add your code here.....

        var now = new Date();//定义局部变量，获取当前时间

        if (now - startTime >= timeLength) { //如果当前时间减去开始时间大于180000ms（即3分钟）
            //OPES_T3.params.current_row_index=lastIndex;
            post_result();
        }


    }

    function _OPES_T3_POST_5_9_(proobj) {
//add your code here.....

        var data_row_list = OPES_T3.params.data_row_list;//获取当前刺激序列

        var current_row = data_row_list[OPES_T3.params.current_row_index];//获取当前刺激

        if (current_row.userResult != current_row.correctResult) {//判断用户答案
            countError++; //错的话，全局变量countError加1
        }

        if (countError == maximumCountError) {
            post_result();
        }
    }

    function _OPES_T3_PRE_6_9_(proobj) {
//add your code here.....

        var now = new Date();//定义局部变量，获取当前时间

        if (now - startTime >= timeLength) { //如果当前时间减去开始时间大于180000ms（即3分钟）
            //OPES_T3.params.current_row_index=lastIndex;
            post_result();
        }


    }

    function _OPES_T3_POST_6_10_(proobj) {
//add your code here.....

        var data_row_list = OPES_T3.params.data_row_list;//获取当前刺激序列

        var current_row = data_row_list[OPES_T3.params.current_row_index];//获取当前刺激

        if (current_row.userResult != current_row.correctResult) {//判断用户答案
            countError++; //错的话，全局变量countError加1
        }

        if (countError == maximumCountError) {
            post_result();
        }
    }

    var OPES_T2 = {};
    OPES_T2.func_name = 'end_';
    OPES_T2.params = {"show_final_result": "1", "final_feedback": "测验结束"};
    OPES_T2.callback = null;
    OPES_T2.flowtitle = '结束';
    OPES_T2.x = 980;
    OPES_T2.y = 133;


    var OPES_T3 = {};
    OPES_T3.func_name = 'data_';
    OPES_T3.params = {
        "current_row_index": -1,
        "randomFlag": "0",
        "data_row_list": [{
            "rowType": "0",
            "userResult": null,
            "showTimer": false,
            "logResultFlag": "1",
            "responseStartTime": null,
            "feedback": {
                "showCorrectResult": true,
                "showMsg": true,
                "showImage": true,
                "cleanupAllColumnsWhenShowFeedback": true,
                "showUserResult": true,
                "msgImage": {
                    "position": {"at": "center bottom", "my": "center bottom"},
                    "height": "30",
                    "width": "30",
                    "msgForCorrectResult": "做对了！",
                    "fontcolor": "fff",
                    "msgForWrongResult": "做错了！",
                    "imgForWrongResultSrc": "/lattice/images/logoicon.png",
                    "fontsize": "30",
                    "imgForCorrectResultSrc": "/lattice/images/logoicon.png"
                },
                "aliveTime": "3000"
            },
            "id": 1,
            "trialid": "1",
            "responseEndTime": null,
            "feedbackFlag": "1",
            "data_column_list": [{
                "position": {"at": "center center-20", "my": "center center-20"},
                "id": 1,
                "delayTime": "1000",
                "text": "1+1",
                "startRecordResponseStartTime": true,
                "fontcolor": "fbfafa",
                "fontfamily": "sans-serif",
                "fontsize": "96",
                "stimulateType": "STIMULATE_TYPE_PLAINTEXT",
                "aliveTime": "9000"
            }, {
                "position": {"at": "center bottom-40", "my": "center bottom-40"},
                "id": 2,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "inputType": "INPUT_TYPE_NUMBER",
                "stimulateType": "STIMULATE_TYPE_INPUT",
                "aliveTime": "9000"
            }, {
                "id": 3,
                "position": {"at": "center+180 bottom-38", "my": "center+180 bottom-38"},
                "delayTime": "1000",
                "text": "确定",
                "startRecordResponseStartTime": true,
                "fontsize": "40",
                "aliveTime": "9000",
                "stimulateType": "STIMULATE_TYPE_BUTTON"
            }, {
                "funName": "_OPES_T3_PRE_1_4_",
                "id": 4,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar now=new Date();//定义局部变量，获取当前时间\n\nif (now-startTime>=timeLength){ //如果当前时间减去开始时间大于180000ms（即3分钟）\n        //OPES_T3.params.current_row_index=lastIndex;\n        post_result();\n}\n\n",
                "stimulateType": "STIMULATE_TYPE_PRE_CUSTOM_CODE",
                "aliveTime": "3000"
            }, {
                "funName": "_OPES_T3_POST_1_5_",
                "id": 5,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar data_row_list=OPES_T3.params.data_row_list;//获取当前刺激序列\n\nvar current_row=data_row_list[OPES_T3.params.current_row_index];//获取当前刺激\n\nif (current_row.userResult!=current_row.correctResult){//判断用户答案\n    countError++; //错的话，全局变量countError加1\n}\n\nif (countError==maximumCountError){\n        post_result();\n}",
                "stimulateType": "STIMULATE_TYPE_POST_CUSTOM_CODE",
                "aliveTime": "3000"
            }],
            "responseType": "RESPONSE_TYPE_SINGLEKEY",
            "aliveType": "ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED",
            "responseDuration": null,
            "responseFlag": "1",
            "correctResult": "2",
            "aliveTime": "10000"
        }, {
            "rowType": "0",
            "userResult": null,
            "showTimer": false,
            "logResultFlag": "1",
            "responseStartTime": null,
            "feedback": {
                "showCorrectResult": true,
                "showMsg": true,
                "showImage": true,
                "cleanupAllColumnsWhenShowFeedback": true,
                "showUserResult": true,
                "msgImage": {
                    "position": {"at": "center bottom", "my": "center bottom"},
                    "height": "30",
                    "width": "30",
                    "msgForCorrectResult": "做对了！",
                    "fontcolor": "fff",
                    "msgForWrongResult": "做错了！",
                    "imgForWrongResultSrc": "/lattice/images/logoicon.png",
                    "fontsize": "30",
                    "imgForCorrectResultSrc": "/lattice/images/logoicon.png"
                },
                "aliveTime": "3000"
            },
            "id": 2,
            "trialid": "2",
            "responseEndTime": null,
            "feedbackFlag": "1",
            "data_column_list": [{
                "position": {"at": "center center-20", "my": "center center-20"},
                "id": 2,
                "delayTime": "1000",
                "text": "1+2",
                "startRecordResponseStartTime": true,
                "fontcolor": "fbfafa",
                "fontfamily": "sans-serif",
                "fontsize": "96",
                "stimulateType": "STIMULATE_TYPE_PLAINTEXT",
                "aliveTime": "9000"
            }, {
                "position": {"at": "center bottom-40", "my": "center bottom-40"},
                "id": 3,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "inputType": "INPUT_TYPE_NUMBER",
                "stimulateType": "STIMULATE_TYPE_INPUT",
                "aliveTime": "9000"
            }, {
                "id": 4,
                "position": {"at": "center+180 bottom-38", "my": "center+180 bottom-38"},
                "delayTime": "1000",
                "text": "确定",
                "startRecordResponseStartTime": true,
                "fontsize": "40",
                "aliveTime": "9000",
                "stimulateType": "STIMULATE_TYPE_BUTTON"
            }, {
                "funName": "_OPES_T3_PRE_2_5_",
                "id": 5,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar now=new Date();//定义局部变量，获取当前时间\n\nif (now-startTime>=timeLength){ //如果当前时间减去开始时间大于180000ms（即3分钟）\n        //OPES_T3.params.current_row_index=lastIndex;\n        post_result();\n}\n\n\n",
                "stimulateType": "STIMULATE_TYPE_PRE_CUSTOM_CODE",
                "aliveTime": "3000"
            }, {
                "funName": "_OPES_T3_POST_2_6_",
                "id": 6,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar data_row_list=OPES_T3.params.data_row_list;//获取当前刺激序列\n\nvar current_row=data_row_list[OPES_T3.params.current_row_index];//获取当前刺激\n\nif (current_row.userResult!=current_row.correctResult){//判断用户答案\n    countError++; //错的话，全局变量countError加1\n}\n\nif (countError==maximumCountError){\n        post_result();\n}",
                "stimulateType": "STIMULATE_TYPE_POST_CUSTOM_CODE",
                "aliveTime": "3000"
            }],
            "responseType": "RESPONSE_TYPE_SINGLEKEY",
            "aliveType": "ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED",
            "responseDuration": null,
            "responseFlag": "1",
            "correctResult": "3",
            "aliveTime": "10000"
        }, {
            "rowType": "0",
            "userResult": null,
            "showTimer": false,
            "logResultFlag": "1",
            "responseStartTime": null,
            "feedback": {
                "showCorrectResult": true,
                "showMsg": true,
                "showImage": true,
                "cleanupAllColumnsWhenShowFeedback": true,
                "showUserResult": true,
                "msgImage": {
                    "position": {"at": "center bottom", "my": "center bottom"},
                    "height": "30",
                    "width": "30",
                    "msgForCorrectResult": "做对了！",
                    "fontcolor": "fff",
                    "msgForWrongResult": "做错了！",
                    "imgForWrongResultSrc": "/lattice/images/logoicon.png",
                    "fontsize": "30",
                    "imgForCorrectResultSrc": "/lattice/images/logoicon.png"
                },
                "aliveTime": "3000"
            },
            "id": 3,
            "trialid": "3",
            "responseEndTime": null,
            "feedbackFlag": "1",
            "data_column_list": [{
                "position": {"at": "center center-20", "my": "center center-20"},
                "id": 3,
                "delayTime": "1000",
                "text": "2+1",
                "startRecordResponseStartTime": true,
                "fontcolor": "fbfafa",
                "fontfamily": "sans-serif",
                "fontsize": "96",
                "stimulateType": "STIMULATE_TYPE_PLAINTEXT",
                "aliveTime": "9000"
            }, {
                "position": {"at": "center bottom-40", "my": "center bottom-40"},
                "id": 4,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "inputType": "INPUT_TYPE_NUMBER",
                "stimulateType": "STIMULATE_TYPE_INPUT",
                "aliveTime": "9000"
            }, {
                "id": 5,
                "position": {"at": "center+180 bottom-38", "my": "center+180 bottom-38"},
                "delayTime": "1000",
                "text": "确定",
                "startRecordResponseStartTime": true,
                "fontsize": "40",
                "aliveTime": "9000",
                "stimulateType": "STIMULATE_TYPE_BUTTON"
            }, {
                "funName": "_OPES_T3_PRE_3_6_",
                "id": 6,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar now=new Date();//定义局部变量，获取当前时间\n\nif (now-startTime>=timeLength){ //如果当前时间减去开始时间大于180000ms（即3分钟）\n        //OPES_T3.params.current_row_index=lastIndex;\n        post_result();\n}\n\n",
                "stimulateType": "STIMULATE_TYPE_PRE_CUSTOM_CODE",
                "aliveTime": "3000"
            }, {
                "funName": "_OPES_T3_POST_3_7_",
                "id": 7,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar data_row_list=OPES_T3.params.data_row_list;//获取当前刺激序列\n\nvar current_row=data_row_list[OPES_T3.params.current_row_index];//获取当前刺激\n\nif (current_row.userResult!=current_row.correctResult){//判断用户答案\n    countError++; //错的话，全局变量countError加1\n}\n\nif (countError==maximumCountError){\n        post_result();\n}",
                "stimulateType": "STIMULATE_TYPE_POST_CUSTOM_CODE",
                "aliveTime": "3000"
            }],
            "responseType": "RESPONSE_TYPE_SINGLEKEY",
            "aliveType": "ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED",
            "responseDuration": null,
            "responseFlag": "1",
            "correctResult": "3",
            "aliveTime": "10000"
        }, {
            "rowType": "0",
            "userResult": null,
            "showTimer": false,
            "logResultFlag": "1",
            "responseStartTime": null,
            "feedback": {
                "showCorrectResult": true,
                "showMsg": true,
                "showImage": true,
                "cleanupAllColumnsWhenShowFeedback": true,
                "showUserResult": true,
                "msgImage": {
                    "position": {"at": "center bottom", "my": "center bottom"},
                    "height": "30",
                    "width": "30",
                    "msgForCorrectResult": "做对了！",
                    "fontcolor": "fff",
                    "msgForWrongResult": "做错了！",
                    "imgForWrongResultSrc": "/lattice/images/logoicon.png",
                    "fontsize": "30",
                    "imgForCorrectResultSrc": "/lattice/images/logoicon.png"
                },
                "aliveTime": "3000"
            },
            "id": 4,
            "trialid": "4",
            "responseEndTime": null,
            "feedbackFlag": "1",
            "data_column_list": [{
                "position": {"at": "center center-20", "my": "center center-20"},
                "id": 4,
                "delayTime": "1000",
                "text": "2-1",
                "startRecordResponseStartTime": true,
                "fontcolor": "fbfafa",
                "fontfamily": "sans-serif",
                "fontsize": "96",
                "stimulateType": "STIMULATE_TYPE_PLAINTEXT",
                "aliveTime": "9000"
            }, {
                "position": {"at": "center bottom-40", "my": "center bottom-40"},
                "id": 5,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "inputType": "INPUT_TYPE_NUMBER",
                "stimulateType": "STIMULATE_TYPE_INPUT",
                "aliveTime": "9000"
            }, {
                "id": 6,
                "position": {"at": "center+180 bottom-38", "my": "center+180 bottom-38"},
                "delayTime": "1000",
                "text": "确定",
                "startRecordResponseStartTime": true,
                "fontsize": "40",
                "aliveTime": "9000",
                "stimulateType": "STIMULATE_TYPE_BUTTON"
            }, {
                "funName": "_OPES_T3_PRE_4_7_",
                "id": 7,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar now=new Date();//定义局部变量，获取当前时间\n\nif (now-startTime>=timeLength){ //如果当前时间减去开始时间大于180000ms（即3分钟）\n        //OPES_T3.params.current_row_index=lastIndex;\n        post_result();\n}\n\n",
                "stimulateType": "STIMULATE_TYPE_PRE_CUSTOM_CODE",
                "aliveTime": "3000"
            }, {
                "funName": "_OPES_T3_POST_4_8_",
                "id": 8,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar data_row_list=OPES_T3.params.data_row_list;//获取当前刺激序列\n\nvar current_row=data_row_list[OPES_T3.params.current_row_index];//获取当前刺激\n\nif (current_row.userResult!=current_row.correctResult){//判断用户答案\n    countError++; //错的话，全局变量countError加1\n}\n\nif (countError==maximumCountError){\n        post_result();\n}",
                "stimulateType": "STIMULATE_TYPE_POST_CUSTOM_CODE",
                "aliveTime": "3000"
            }],
            "responseType": "RESPONSE_TYPE_SINGLEKEY",
            "aliveType": "ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED",
            "responseDuration": null,
            "responseFlag": "1",
            "correctResult": "1",
            "aliveTime": "10000"
        }, {
            "rowType": "0",
            "userResult": null,
            "showTimer": false,
            "logResultFlag": "1",
            "responseStartTime": null,
            "feedback": {
                "showCorrectResult": true,
                "showMsg": true,
                "showImage": true,
                "cleanupAllColumnsWhenShowFeedback": true,
                "showUserResult": true,
                "msgImage": {
                    "position": {"at": "center bottom", "my": "center bottom"},
                    "height": "30",
                    "width": "30",
                    "msgForCorrectResult": "做对了！",
                    "fontcolor": "fff",
                    "msgForWrongResult": "做错了！",
                    "imgForWrongResultSrc": "/lattice/images/logoicon.png",
                    "fontsize": "30",
                    "imgForCorrectResultSrc": "/lattice/images/logoicon.png"
                },
                "aliveTime": "3000"
            },
            "id": 5,
            "trialid": "5",
            "responseEndTime": null,
            "feedbackFlag": "1",
            "data_column_list": [{
                "position": {"at": "center center-20", "my": "center center-20"},
                "id": 5,
                "delayTime": "1000",
                "text": "3-1",
                "startRecordResponseStartTime": true,
                "fontcolor": "fbfafa",
                "fontfamily": "sans-serif",
                "fontsize": "96",
                "stimulateType": "STIMULATE_TYPE_PLAINTEXT",
                "aliveTime": "9000"
            }, {
                "position": {"at": "center bottom-40", "my": "center bottom-40"},
                "id": 6,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "inputType": "INPUT_TYPE_NUMBER",
                "stimulateType": "STIMULATE_TYPE_INPUT",
                "aliveTime": "9000"
            }, {
                "id": 7,
                "position": {"at": "center+180 bottom-38", "my": "center+180 bottom-38"},
                "delayTime": "1000",
                "text": "确定",
                "startRecordResponseStartTime": true,
                "fontsize": "40",
                "aliveTime": "9000",
                "stimulateType": "STIMULATE_TYPE_BUTTON"
            }, {
                "funName": "_OPES_T3_PRE_5_8_",
                "id": 8,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar now=new Date();//定义局部变量，获取当前时间\n\nif (now-startTime>=timeLength){ //如果当前时间减去开始时间大于180000ms（即3分钟）\n        //OPES_T3.params.current_row_index=lastIndex;\n        post_result();\n}\n\n",
                "stimulateType": "STIMULATE_TYPE_PRE_CUSTOM_CODE",
                "aliveTime": "3000"
            }, {
                "funName": "_OPES_T3_POST_5_9_",
                "id": 9,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar data_row_list=OPES_T3.params.data_row_list;//获取当前刺激序列\n\nvar current_row=data_row_list[OPES_T3.params.current_row_index];//获取当前刺激\n\nif (current_row.userResult!=current_row.correctResult){//判断用户答案\n    countError++; //错的话，全局变量countError加1\n}\n\nif (countError==maximumCountError){\n        post_result();\n}",
                "stimulateType": "STIMULATE_TYPE_POST_CUSTOM_CODE",
                "aliveTime": "3000"
            }],
            "responseType": "RESPONSE_TYPE_SINGLEKEY",
            "aliveType": "ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED",
            "responseDuration": null,
            "responseFlag": "1",
            "correctResult": "2",
            "aliveTime": "10000"
        }, {
            "rowType": "0",
            "userResult": null,
            "showTimer": false,
            "logResultFlag": "1",
            "responseStartTime": null,
            "feedback": {
                "showCorrectResult": true,
                "showMsg": true,
                "showImage": true,
                "cleanupAllColumnsWhenShowFeedback": true,
                "showUserResult": true,
                "msgImage": {
                    "position": {"at": "center bottom", "my": "center bottom"},
                    "height": "30",
                    "width": "30",
                    "msgForCorrectResult": "做对了！",
                    "fontcolor": "fff",
                    "msgForWrongResult": "做错了！",
                    "imgForWrongResultSrc": "/lattice/images/logoicon.png",
                    "fontsize": "30",
                    "imgForCorrectResultSrc": "/lattice/images/logoicon.png"
                },
                "aliveTime": "3000"
            },
            "id": 6,
            "trialid": "6",
            "responseEndTime": null,
            "feedbackFlag": "1",
            "data_column_list": [{
                "position": {"at": "center center-20", "my": "center center-20"},
                "id": 6,
                "delayTime": "1000",
                "text": "4-1",
                "startRecordResponseStartTime": true,
                "fontcolor": "fbfafa",
                "fontfamily": "sans-serif",
                "fontsize": "96",
                "stimulateType": "STIMULATE_TYPE_PLAINTEXT",
                "aliveTime": "9000"
            }, {
                "position": {"at": "center bottom-40", "my": "center bottom-40"},
                "id": 7,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "inputType": "INPUT_TYPE_NUMBER",
                "stimulateType": "STIMULATE_TYPE_INPUT",
                "aliveTime": "9000"
            }, {
                "id": 8,
                "position": {"at": "center+180 bottom-38", "my": "center+180 bottom-38"},
                "delayTime": "1000",
                "text": "确定",
                "startRecordResponseStartTime": true,
                "fontsize": "40",
                "aliveTime": "9000",
                "stimulateType": "STIMULATE_TYPE_BUTTON"
            }, {
                "funName": "_OPES_T3_PRE_6_9_",
                "id": 9,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar now=new Date();//定义局部变量，获取当前时间\n\nif (now-startTime>=timeLength){ //如果当前时间减去开始时间大于180000ms（即3分钟）\n        //OPES_T3.params.current_row_index=lastIndex;\n        post_result();\n}\n\n",
                "stimulateType": "STIMULATE_TYPE_PRE_CUSTOM_CODE",
                "aliveTime": "3000"
            }, {
                "funName": "_OPES_T3_POST_6_10_",
                "id": 10,
                "delayTime": "1000",
                "startRecordResponseStartTime": true,
                "code": "//add your code here.....\n\nvar data_row_list=OPES_T3.params.data_row_list;//获取当前刺激序列\n\nvar current_row=data_row_list[OPES_T3.params.current_row_index];//获取当前刺激\n\nif (current_row.userResult!=current_row.correctResult){//判断用户答案\n    countError++; //错的话，全局变量countError加1\n}\n\nif (countError==maximumCountError){\n        post_result();\n}",
                "stimulateType": "STIMULATE_TYPE_POST_CUSTOM_CODE",
                "aliveTime": "3000"
            }],
            "responseType": "RESPONSE_TYPE_SINGLEKEY",
            "aliveType": "ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED",
            "responseDuration": null,
            "responseFlag": "1",
            "correctResult": "3",
            "aliveTime": "10000"
        }],
        "showtype": "TEST_TYPE_TYPICAL"
    };
    OPES_T3.callback = OPES_T2;
    OPES_T3.flowtitle = '刺激系列（和3以内）';
    OPES_T3.x = 700;
    OPES_T3.y = 328;


    var OPES_T10 = {};
    OPES_T10.func_name = 'timer_';
    OPES_T10.params = {"timelimit": "60000"};
    OPES_T10.callback = OPES_T3;
    OPES_T10.flowtitle = '时间控制';
    OPES_T10.x = 639;
    OPES_T10.y = 111;


    var OPES_T5 = {};
    OPES_T5.func_name = 'code_';
    OPES_T5.params = {
        "funName": "_CUSTOM_OPES_T5_1492659693780_",
        "code": "//add your code here.....\n//Here you can access all the variables: \n//e.g. OPES_T2.func_name OPES_T3.params.code ... \n\n\n\n\ncountError=0;    //limited to 5 errors. \n\ntimeLength=60000;   //in milliseconds  1x60x1000=60000ms . limited to 1 mins. \n\nstartTime=new Date();    //定义全局变量starttime，记录开始时间\n\nstarttime=0;\nmaximumCountError=5;\n"
    };
    OPES_T5.callback = OPES_T10;
    OPES_T5.flowtitle = '代码控制';
    OPES_T5.x = 450;
    OPES_T5.y = 529;


    var OPES_T11 = {};
    OPES_T11.func_name = 'data_';
    OPES_T11.params = {
        "current_row_index": -1,
        "randomFlag": "0",
        "data_row_list": [{
            "rowType": "0",
            "userResult": null,
            "showTimer": false,
            "logResultFlag": "1",
            "responseStartTime": null,
            "feedback": {
                "showCorrectResult": true,
                "showMsg": true,
                "showImage": true,
                "cleanupAllColumnsWhenShowFeedback": true,
                "showUserResult": true,
                "msgImage": {
                    "position": {"at": "center bottom", "my": "center bottom"},
                    "height": "30",
                    "width": "30",
                    "msgForCorrectResult": "做对了！",
                    "fontcolor": "fff",
                    "msgForWrongResult": "做错了！",
                    "imgForWrongResultSrc": "/lattice/images/logoicon.png",
                    "fontsize": "30",
                    "imgForCorrectResultSrc": "/lattice/images/logoicon.png"
                },
                "aliveTime": "3000"
            },
            "id": 7,
            "responseEndTime": null,
            "trialid": "7",
            "feedbackFlag": "0",
            "data_column_list": [{
                "position": {"at": "center center", "my": "center center"},
                "delayTime": "1000",
                "onclickFunName": "_OPES_T11_IMG_ONCLICK_7_1_",
                "startRecordResponseStartTime": true,
                "useGlobalDefinedFunctionForOnclick": false,
                "width": "460",
                "onclickFunCode": "//add your code here.....\nalert(proobj.id+'_____'+proobj.src);\nalert(JSON.stringify(__TEMP_GLOBAL_VARIABLE_FOR_IMAGE_ON_CLICK_passobj));",
                "enableOnclickEvent": false,
                "stimulateType": "STIMULATE_TYPE_IMAGE",
                "id": 1,
                "height": "320",
                "src": "1.png",
                "aliveTime": "99999999"
            }, {
                "id": 2,
                "position": {"at": "center+410 center+210", "my": "center center"},
                "delayTime": "1000",
                "text": "进入练习",
                "startRecordResponseStartTime": true,
                "fontsize": "30",
                "aliveTime": "99999999",
                "stimulateType": "STIMULATE_TYPE_BUTTON"
            }],
            "responseType": "RESPONSE_TYPE_SINGLEKEY",
            "aliveType": "ROW_ALIVE_TYPE_ALIVETIME_RESPONSE_FIRST_COME_FIRST_SERVED",
            "responseFlag": "1",
            "responseDuration": null,
            "correctResult": "",
            "aliveTime": "99999999"
        }],
        "showtype": "TEST_TYPE_TYPICAL"
    };
    OPES_T11.callback = OPES_T5;
    OPES_T11.flowtitle = '刺激系列（和3以内）';
    OPES_T11.x = 280;
    OPES_T11.y = 388;


    var OPES_T1 = {};
    OPES_T1.func_name = 'start_';
    OPES_T1.params = {
        "mousetype": "auto",
        "setbackgroundimg": false,
        "mouse_type_image": "/lattice/images/empty.cur",
        "pagebackground": "000000",
        "fontcolor": "FFFFFF",
        "backgroundimgsrc": "/lattice/images/empty.cur",
        "doPreload": true,
        "fontsize": "30px",
        "pagetitle": "多维心理网络版心理实验系统"
    };
    OPES_T1.callback = OPES_T11;
    OPES_T1.flowtitle = '开始';
    OPES_T1.x = 185;
    OPES_T1.y = 126;


    $(document).ready(function () {

//define the global variable OPES_T_START, so that any code can refer this start point of test result data.
        OPES_T_START = OPES_T1;

        exec_func_util(OPES_T1.func_name, OPES_T1.params, OPES_T1);
    });

</script>
</html>



